<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.92.2">
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/observability-workshop/v4.14/favicons/favicon.ico>
<link rel=apple-touch-icon href=/observability-workshop/v4.14/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/observability-workshop/v4.14/favicons/android-192x192.png sizes=192x192>
<title>Splunk Observability Cloud Workshops</title>
<meta name=description content="Create a SignalFx Detector
Aim
We need to create a new Detector within SignalFx which will use VictorOps as the target to send alerts to.
We will use …">
<meta property="og:title" content>
<meta property="og:description" content="Create a SignalFx Detector Aim We need to create a new Detector within SignalFx which will use VictorOps as the target to send alerts to.
We will use Terraform installed within the VM to create the Detector, but first we need to obtain some values required for Terraform to run.
 1. Preparation The presenter will typically share these values with you at the start of the module to save time, but the following instructions explain how to get them for yourself.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://signalfx.github.io/observability-workshop/v4.14/oncall/optional/detector/"><meta property="article:section" content="oncall">
<meta property="article:modified_time" content="2022-03-02T20:39:54+01:00"><meta property="og:site_name" content="Splunk Observability Cloud Workshops">
<meta itemprop=name content>
<meta itemprop=description content="Create a SignalFx Detector Aim We need to create a new Detector within SignalFx which will use VictorOps as the target to send alerts to.
We will use Terraform installed within the VM to create the Detector, but first we need to obtain some values required for Terraform to run.
 1. Preparation The presenter will typically share these values with you at the start of the module to save time, but the following instructions explain how to get them for yourself.">
<meta itemprop=dateModified content="2022-03-02T20:39:54+01:00">
<meta itemprop=wordCount content="1183">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="Create a SignalFx Detector Aim We need to create a new Detector within SignalFx which will use VictorOps as the target to send alerts to.
We will use Terraform installed within the VM to create the Detector, but first we need to obtain some values required for Terraform to run.
 1. Preparation The presenter will typically share these values with you at the start of the module to save time, but the following instructions explain how to get them for yourself.">
<link rel=preload href=/observability-workshop/v4.14/scss/main.min.deddc9b57e65de2e36e0a7912039ccf70079af844257489a558c52de37f7ad90.css as=style>
<link href=/observability-workshop/v4.14/scss/main.min.deddc9b57e65de2e36e0a7912039ccf70079af844257489a558c52de37f7ad90.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar1>
<a class=navbar-brand href=/observability-workshop/v4.14/>
<span class=navbar-logo><img class=navbar-logo src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAIAAAD8RQT7AAACwklEQVRYw+2YW2jTYBTHu4l4F1ERVMQL+qKgMBUU9EEfRAURUUFfBEUEBRGfdC+CrVt3cdbNSZ1zXqar024yp9MJKzh3FScyO+q8MDW3pvc2TZqkudSvtD4J66fkWyL0kNeQH8mX8/+dY8JMZuNcpjzNX9JQK64ZiEZlk9zDEe/aOmPQ8FIKlJpKtH+mNzUYg+Z38a7vvu2NRqHJlDhABPY0G4UmU8lhOnioFSu0GIImU9KXUOhYOz75kiFoMiVjsfDpl/i0UrQ0oePPkp5ACq5kHxs978JnlaHsxQVm/24H3zUGyaRE+Jj5DTGvEm0yeNfVsfeGVVGGYQJtk6kaIBfZ0OYUufBKrKRHCSWgmAQ5fmOIWl6DNjXx6dbwqRfgh4L6eJLC3v/oXW1HnOGFlsDeR0L3TygmEC+tn+j19ciNgt5Qzznc4B3AUPGd33xb7yL3G3LJVaaiX4kKMExCD+bf2YTctvCZZZEzndJYBIZJfE8F9jtBE0HsfpMswQNOoR+HYWIbPkyQiQIr4pyelKyOQ5No8UyoF1PLahjboMqIhqABl3/HA6EX05kGyEboSBuQIZ2/FDGnInKuSyaZnKcYLU32lMTF3P05ITHVb8nFNiQ09MZbXPPI+H9QliMuMuV9xIIqBN2vwAy8HTKw0gJ0sZuYW6l9MuBTS8MnnkujQSgOPxctdhGzy7VPTWL+5eiF1+ABUJJKMpGzr4CHaG8U1KrauH0IHEAot/kRDZ/swKeUaG9bvi13Em2jKUWF4gDDzdGn/zbcmHJE4MEWcZCAFPWk2xc8/ATcpbGl4zOsYFCC1IOsIex7/KchaEMj0ywkh9CH+3c59J8104uLbY36T758x1d68229twIZ+y+6qffGRFa5Jrd3jR3Td5ukJhVgr9TKWp03benp9fo7cmm1/lvImLUXDN757XWe5v+g+QU6sNkgKUPrgwAAAABJRU5ErkJggg=="></span><span class=font-weight-bold>Splunk Observability Cloud Workshops</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
</ul>
</div>
</nav>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar2>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.14/imt/><span>Splunk IMT</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.14/apm/><span>Splunk APM</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.14/synthetics/><span>Splunk Synthetics</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.14/rum/><span>Splunk RUM</span></a>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
More Workshops
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/pet-clinic/>Pet Clinic Java Workshop</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/bootcamp/>O11y Bootcamp</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/resources/>Resources</a>
</div>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Releases
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/>latest</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/v4.13>v4.13</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/v4.14>v4.14</a>
</div>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/observability-workshop/v4.14/ja/>日本語</a>
</div>
</li>
</ul>
</div>
</nav>
</header>
<div class="container-fluid td-default td-outer">
<main role=main class=td-main>
<h1 id=create-a-signalfx-detector>Create a SignalFx Detector</h1>
<h2 id=aim>Aim</h2>
<p>We need to create a new Detector within SignalFx which will use VictorOps as the target to send alerts to.</p>
<p>We will use Terraform installed within the VM to create the Detector, but first we need to obtain some values required for Terraform to run.</p>
<hr>
<h2 id=1-preparation>1. Preparation</h2>
<p>The presenter will typically share these values with you at the start of the module to save time, but the following instructions explain how to get them for yourself.</p>
<h3 id=11-create-a-variables-document>1.1 Create a variables document</h3>
<p>We suggest you create a variables document using your preferred text editor as you will be gathering three different values in the next few steps which you need to use in the last step of this module.</p>
<p>Add the following lines to your variables document, then as you gather the values you can add them to the appropriate lines:</p>
<p>=== &ldquo;variables.txt&rdquo;</p>
<pre><code>``` text
export ACCESS_TOKEN=
export REALM=
export SFXVOPSID=
```
</code></pre>
<h3 id=12-obtain-signalfx-access-token>1.2 Obtain SignalFx Access Token</h3>
<p>In the Splunk UI you can find your <strong>Access Token</strong> by clicking on the <strong>Settings</strong> icon on the top right of the Splunk UI, select <strong>Organization Settings → Access Tokens</strong>, expand the <strong>Default</strong> token, then click on <strong>Show Token</strong> to expose your token.</p>
<p><img src=..//images/oncall/m7-access-token.png alt="Access Token"></p>
<p>Click the <strong>Copy</strong>{: .label-button .sfx-ui-button-blue} button to copy it you your clipboard, then paste it into the <code>ACCESS_TOKEN</code> line of your variables document.</p>
<p>=== &ldquo;variables.txt&rdquo;</p>
<pre><code>```text
export ACCESS_TOKEN={==xxxx==}
export REALM=
export SFXVOPSID=
```
</code></pre>
<h3 id=13-obtain-signalfx-realm>1.3 Obtain SignalFx Realm</h3>
<p>Still in the Splunk UI, click on the <strong>Settings</strong> icon again, but this time select <strong>My Profile</strong>.</p>
<p>The Realm can be found in the middle of the page within the Organizations section. In this example it is <strong>us1</strong>, but yours may be <strong>eu0</strong> or one of the many other SignalFx Realms.</p>
<p><img src=..//images/oncall/m7-realm.png alt=Realm></p>
<p>Copy it to the <code>REALM</code> line of your variables document.</p>
<p>=== &ldquo;variables.txt&rdquo;</p>
<pre><code>```text
export ACCESS_TOKEN={==xxxx==}
export REALM={==xxxx==}
export SFXVOPSID=
```
</code></pre>
<h3 id=14-obtain-victorops-integration-id>1.4. Obtain VictorOps Integration ID</h3>
<p>In Splunk UI navigate to <strong>Integrations</strong> and use the search feature to find the VictorOps Integration.</p>
<p>Expand the <strong>VictorOps-xxxx</strong> configuration; if there are more than one you will be informed which one to copy by the presenter.</p>
<p><img src=..//images/oncall/m7-sfx-vo-integration-id.png alt="VictorOps Integration"></p>
<p>Copy it to the <code>SFXVOPSID</code> line of your variables document.</p>
<p>=== &ldquo;variables.txt&rdquo;</p>
<pre><code>```text
export ACCESS_TOKEN={==xxxx==}
export REALM={==xxxx==}
export SFXVOPSID={==xxxx==}
```
</code></pre>
<hr>
<h2 id=2-create-environment-variables>2. Create environment variables</h2>
<h3 id=21-copy-variables-to-vm>2.1 Copy variables to VM</h3>
<p>With all the required values now safely copied into your variables document you can use them to compile the commands which we will run in your VM in the next step.</p>
<p>=== &ldquo;Example&rdquo;</p>
<pre><code>```text
export SFXVOPSID=EYierbGA4AA
export ACCESS_TOKEN=by78voyt7b.....
export REALM=us1
```
</code></pre>
<p>Switch back to your shell session connected to the VM you created in the <strong>Getting Started/Create a Test Environment</strong> module, all of the following commands will be executed within this instance:</p>
<p>Past the three commands from your variables document into the shell session of your VM.</p>
<h2 id=3-initialize-and-apply-terraform>3. Initialize and apply Terraform</h2>
<p>Still within your VM, switch to the victorops folder where the Terraform config files are located (you should still be logged in as Ubuntu and should not have elevated to root)</p>
<p>=== &ldquo;Change Directory&rdquo;</p>
<pre><code>```text
cd ~/workshop/victorops
```
</code></pre>
<p>Now we can initialize Terraform:</p>
<p>=== &ldquo;Shell Command&rdquo;</p>
<pre><code>```text
terraform init -upgrade
```
</code></pre>
<p>=== &ldquo;Example Output&rdquo;</p>
<pre><code>```text
Initializing the backend...

Initializing provider plugins...
- Checking for available provider plugins...
- Downloading plugin for provider &quot;signalfx&quot; (terraform-providers/signalfx) 4.21.0...

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = &quot;...&quot; constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.signalfx: version = &quot;~&gt; 4.21&quot;

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
```
</code></pre>
<p>You can now copy and the paste the following code block to run Terraform using the Variables you created in the VM. Check the plan output for errors before typing <em><strong>yes</strong></em> to commit the apply.</p>
<p>=== &ldquo;Shell Command&rdquo;</p>
<pre><code>```text
terraform apply \
-var=&quot;access_token=$ACCESS_TOKEN&quot; \
-var=&quot;realm=$REALM&quot; \
-var=&quot;sfx_prefix=${HOSTNAME}&quot; \
-var=&quot;sfx_vo_id=$SFXVOPSID&quot; \
-var=&quot;routing_key=${HOSTNAME}_PRI&quot;
```
</code></pre>
<p>=== &ldquo;Example Output&rdquo;</p>
<pre><code>```
An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # signalfx_detector.cpu_greater_90 will be created
  + resource &quot;signalfx_detector&quot; &quot;cpu_greater_90&quot; {
      + description       = &quot;Alerts when CPU usage is greater than 90%&quot;
      + id                = (known after apply)
      + max_delay         = 0
      + name              = &quot;vmpe CPU greater than 90%&quot;
      + program_text      = &lt;&lt;~EOT
            from signalfx.detectors.against_recent import against_recent
            A = data('cpu.utilization', filter=filter('host', 'vmpe*')).publish(label='A')
            detect(when(A &gt; threshold(90))).publish('CPU utilization is greater than 90%')
        EOT
      + show_data_markers = true
      + time_range        = 3600
      + url               = (known after apply)

      + rule {
          + detect_label          = &quot;CPU utilization is greater than 90%&quot;
          + disabled              = false
          + notifications         = [
              + &quot;VictorOps,xxx,vmpe_pri&quot;,
            ]
          + parameterized_body    = &lt;&lt;~EOT
                {{#if anomalous}}
                    Rule &quot;{{{ruleName}}}&quot; in detector &quot;{{{detectorName}}}&quot; triggered at {{timestamp}}.
                {{else}}
                    Rule &quot;{{{ruleName}}}&quot; in detector &quot;{{{detectorName}}}&quot; cleared at {{timestamp}}.
                {{/if}}
                
                {{#if anomalous}}
                  Triggering condition: {{{readableRule}}}
                {{/if}}
                
                {{#if anomalous}}
                  Signal value: {{inputs.A.value}}
                {{else}}
                  Current signal value: {{inputs.A.value}}
                {{/if}}
                
                {{#notEmpty dimensions}}
                  Signal details: {{{dimensions}}}
                {{/notEmpty}}
                
                {{#if anomalous}}
                  {{#if runbookUrl}}
                    Runbook: {{{runbookUrl}}}
                  {{/if}}
                  {{#if tip}}
                    Tip: {{{tip}}}
                  {{/if}}
                {{/if}}
            EOT
          + parameterized_subject = &quot;{{ruleSeverity}} Alert: {{{ruleName}}} ({{{detectorName}}})&quot;
          + severity              = &quot;Critical&quot;
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions in workspace &quot;Workshop&quot;?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

signalfx_detector.cpu_greater_90: Creating...
signalfx_detector.cpu_greater_90: Creation complete after 2s [id=EWHU-YAAAAA]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
```
</code></pre>
<hr>
<h2 id=4-summary>4. Summary</h2>
<p>By running Terraform within the VM you have just created a new Detector within SignalFx which will send alerts to VictorOps if the CPU utilization of your specific VM goes above 90%.</p>
<p>In the Splunk UI go to <strong>Alerts → Detectors</strong> to show all the Detectors and find the one matching your <code>INSTANCE</code> value (the first four letters of the name of your VM).</p>
<p>Optionally - Click on <strong>CPU Utilization is greater than 90%</strong> to open the Alert Rule Editor to view its settings.</p>
<p><img src=..//images/oncall/detector.png alt=Detector></p>
<p>A filter has been used to specifically monitor your VM using the 1st 4 characters of its name, which were randomly assigned when you created the VM.</p>
<p><img src=..//images/oncall/detector-filter.png alt="Detector Filter"></p>
<p>A <strong>Recipient</strong> has been configured using the VictorOps Integration and your <strong>Routing Key</strong> has been specified. This is how a monitoring system such as SignalFx knows to route Alerts into VictorOps, and ensure they get routed to the correct team.</p>
<p><img src=..//images/oncall/detector-recipients.png alt="Detector Recipients"></p>
<hr>
<p>You have now configured the Integrations between VictorOps and SignalFx!</p>
<p>The final part of this module is to test the flow of alerts from SignalFx into VictorOps and see how you can manage the incident with both the VictorOps UI and Mobile App.</p>
</main>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel=noopener href=https://twitter.com/splunk aria-label=Twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/signalfx/observability-workshop aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 Splunk Inc. All Rights Reserved</small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/observability-workshop/v4.14/js/tabpane-persist.js></script>
<script src=/observability-workshop/v4.14/js/main.min.8ab8f81ff7e1454d30024cd6f956d4d341c3a97e2a673f988065f2ee4e147922.js integrity="sha256-irj4H/fhRU0wAkzW+VbU00HDqX4qZz+YgGXy7k4UeSI=" crossorigin=anonymous></script>
</body>
</html>