<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.92.2">
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/observability-workshop/v4.35/favicons/favicon.ico>
<link rel=apple-touch-icon href=/observability-workshop/v4.35/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/observability-workshop/v4.35/favicons/android-192x192.png sizes=192x192>
<title>Deploying NGINX in K3s | Splunk Observability Cloud Workshops</title>
<meta name=description content="
Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.
Run a load test to create metrics and confirm …">
<meta property="og:title" content="Deploying NGINX in K3s">
<meta property="og:description" content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!   1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://signalfx.github.io/observability-workshop/v4.35/imt/docs/gdi/nginx/"><meta property="article:section" content="imt">
<meta property="article:modified_time" content="2022-11-22T10:28:56+00:00"><meta property="og:site_name" content="Splunk Observability Cloud Workshops">
<meta itemprop=name content="Deploying NGINX in K3s">
<meta itemprop=description content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!   1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods.">
<meta itemprop=dateModified content="2022-11-22T10:28:56+00:00">
<meta itemprop=wordCount content="561">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Deploying NGINX in K3s">
<meta name=twitter:description content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!   1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods.">
<link rel=preload href=/observability-workshop/v4.35/scss/main.min.39785c4da9cb0cfe16de8f72aadcf06fb29187963dcb8220bb9935bd52331915.css as=style>
<link href=/observability-workshop/v4.35/scss/main.min.39785c4da9cb0cfe16de8f72aadcf06fb29187963dcb8220bb9935bd52331915.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar1>
<a class=navbar-brand href=/observability-workshop/v4.35/>
<span class=navbar-logo><img class=navbar-logo src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAIAAAD8RQT7AAACwklEQVRYw+2YW2jTYBTHu4l4F1ERVMQL+qKgMBUU9EEfRAURUUFfBEUEBRGfdC+CrVt3cdbNSZ1zXqar024yp9MJKzh3FScyO+q8MDW3pvc2TZqkudSvtD4J66fkWyL0kNeQH8mX8/+dY8JMZuNcpjzNX9JQK64ZiEZlk9zDEe/aOmPQ8FIKlJpKtH+mNzUYg+Z38a7vvu2NRqHJlDhABPY0G4UmU8lhOnioFSu0GIImU9KXUOhYOz75kiFoMiVjsfDpl/i0UrQ0oePPkp5ACq5kHxs978JnlaHsxQVm/24H3zUGyaRE+Jj5DTGvEm0yeNfVsfeGVVGGYQJtk6kaIBfZ0OYUufBKrKRHCSWgmAQ5fmOIWl6DNjXx6dbwqRfgh4L6eJLC3v/oXW1HnOGFlsDeR0L3TygmEC+tn+j19ciNgt5Qzznc4B3AUPGd33xb7yL3G3LJVaaiX4kKMExCD+bf2YTctvCZZZEzndJYBIZJfE8F9jtBE0HsfpMswQNOoR+HYWIbPkyQiQIr4pyelKyOQ5No8UyoF1PLahjboMqIhqABl3/HA6EX05kGyEboSBuQIZ2/FDGnInKuSyaZnKcYLU32lMTF3P05ITHVb8nFNiQ09MZbXPPI+H9QliMuMuV9xIIqBN2vwAy8HTKw0gJ0sZuYW6l9MuBTS8MnnkujQSgOPxctdhGzy7VPTWL+5eiF1+ABUJJKMpGzr4CHaG8U1KrauH0IHEAot/kRDZ/swKeUaG9bvi13Em2jKUWF4gDDzdGn/zbcmHJE4MEWcZCAFPWk2xc8/ATcpbGl4zOsYFCC1IOsIex7/KchaEMj0ywkh9CH+3c59J8104uLbY36T758x1d68229twIZ+y+6qffGRFa5Jrd3jR3Td5ukJhVgr9TKWp03benp9fo7cmm1/lvImLUXDN757XWe5v+g+QU6sNkgKUPrgwAAAABJRU5ErkJggg=="></span><span class=font-weight-bold>Splunk Observability Cloud Workshops</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
</ul>
</div>
</nav>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar2>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/observability-workshop/v4.35/imt/><span class=active>Splunk IMT</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.35/apm/><span>Splunk APM</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.35/synthetics/><span>Splunk Synthetics</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/observability-workshop/v4.35/rum/><span>Splunk RUM</span></a>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
More Workshops
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/pet-clinic/>Pet Clinic Java Workshop</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/bootcamp/>O11y Bootcamp</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/resources/>Resources</a>
</div>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Releases
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/latest/>latest</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/v4.34>v4.34</a>
<a class=dropdown-item href=https://signalfx.github.io/observability-workshop/v4.35>v4.35</a>
</div>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/observability-workshop/v4.35/ja/imt/docs/gdi/nginx/>日本語</a>
</div>
</li>
</ul>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/observability-workshop/v4.35/offline-search-index.4337dc149b418667355574dea852fe4e.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<div class="nav-item dropdown d-block d-lg-none">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/observability-workshop/v4.35/ja/imt/docs/gdi/nginx/>日本語</a>
</div>
</div>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-observability-workshopv435imt-li>
<a href=/observability-workshop/v4.35/imt/ title=Introduction class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-observability-workshopv435imt><span>Splunk IMT</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-observability-workshopv435imtdocs-li>
<a href=/observability-workshop/v4.35/imt/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocs><span>Setup and Exercises</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsinitial-setup-li>
<a href=/observability-workshop/v4.35/imt/docs/initial-setup/ title="How to connect to your workshop environment" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsinitial-setup><span>Access AWS/EC2 Instance</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-observability-workshopv435imtdocsgdi-li>
<a href=/observability-workshop/v4.35/imt/docs/gdi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocsgdi><span>Get Data In</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsgdik3s-li>
<a href=/observability-workshop/v4.35/imt/docs/gdi/k3s/ title="Deploying the OpenTelemetry Collector in Kubernetes" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsgdik3s><span>Deploy the OTel Collector</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-observability-workshopv435imtdocsgdinginx-li>
<a href=/observability-workshop/v4.35/imt/docs/gdi/nginx/ title="Deploying NGINX in K3s" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsgdinginx><span class=td-sidebar-nav-active-item>Deploy and Monitor NGIX</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv435imtdocsdashboards-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/ title="Working with Dashboards" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocsdashboards><span>Dashboards</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardsintro-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/intro/ title="Working with Dashboards, Charts and Metrics" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardsintro><span>Introduction</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardsediting-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/editing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardsediting><span>Editing charts</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardssavingcharts-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/savingcharts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardssavingcharts><span>Saving charts</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardsfiltering-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/filtering/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardsfiltering><span>Using Filters & Formulas</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardssignalflow-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/signalflow/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardssignalflow><span>SignalFlow</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardsadding-charts-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/adding-charts/ title="Adding charts to dashboards" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardsadding-charts><span>Adding more charts</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdashboardsdashboarding-li>
<a href=/observability-workshop/v4.35/imt/docs/dashboards/dashboarding/ title="Adding Notes and Dashboard Layout" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdashboardsdashboarding><span>Notes and layout</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv435imtdocsdetectors-li>
<a href=/observability-workshop/v4.35/imt/docs/detectors/ title="Working with Detectors" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocsdetectors><span>Detectors</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdetectorscreating-li>
<a href=/observability-workshop/v4.35/imt/docs/detectors/creating/ title="Working with Detectors - Lab Summary" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdetectorscreating><span>Creating a Detector</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsdetectorsmuting-li>
<a href=/observability-workshop/v4.35/imt/docs/detectors/muting/ title="Working with Muting Rules - Lab Summary" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsdetectorsmuting><span>Creating a Muting Rule</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv435imtdocsmonitoring-as-code-li>
<a href=/observability-workshop/v4.35/imt/docs/monitoring-as-code/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocsmonitoring-as-code><span>Monitoring as Code</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsmonitoring-as-codeterraform-li>
<a href=/observability-workshop/v4.35/imt/docs/monitoring-as-code/terraform/ title="Monitoring as Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsmonitoring-as-codeterraform><span>Plan, Apply, Destroy</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv435imtdocsservicebureau-li>
<a href=/observability-workshop/v4.35/imt/docs/servicebureau/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv435imtdocsservicebureau><span>Service Bureau</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsservicebureaubilling-and-usage-li>
<a href=/observability-workshop/v4.35/imt/docs/servicebureau/billing-and-usage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsservicebureaubilling-and-usage><span>Subscription Usage</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsservicebureauteams-li>
<a href=/observability-workshop/v4.35/imt/docs/servicebureau/teams/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsservicebureauteams><span>Teams</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv435imtdocsservicebureautokens-li>
<a href=/observability-workshop/v4.35/imt/docs/servicebureau/tokens/ title="Controlling Usage" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv435imtdocsservicebureautokens><span>Control Usage</span></a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#1-start-your-nginx>1. Start your NGINX</a></li>
<li><a href=#2-create-nginx-deployment>2. Create NGINX deployment</a></li>
<li><a href=#3-run-locust-load-test>3. Run Locust load test</a></li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class=td-breadcrumbs>
<ol class=breadcrumb>
<li class=breadcrumb-item>
<a href=https://signalfx.github.io/observability-workshop/v4.35/imt/>Splunk IMT</a>
</li>
<li class=breadcrumb-item>
<a href=https://signalfx.github.io/observability-workshop/v4.35/imt/docs/>Setup and Exercises</a>
</li>
<li class=breadcrumb-item>
<a href=https://signalfx.github.io/observability-workshop/v4.35/imt/docs/gdi/>Get Data In</a>
</li>
<li class="breadcrumb-item active" aria-current=page>
<a href=https://signalfx.github.io/observability-workshop/v4.35/imt/docs/gdi/nginx/>Deploy and Monitor NGIX</a>
</li>
</ol>
</nav>
<div class=td-content>
<h1>Deploying NGINX in K3s</h1>
<header class=article-meta>
<p class=reading-time><i class="fa fa-clock" aria-hidden=true></i>&nbsp; 3 minute read &nbsp;</p>
</header>
<ul>
<li>Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.</li>
<li>Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!</li>
</ul>
<hr>
<h2 id=1-start-your-nginx>1. Start your NGINX</h2>
<p>Verify the number of pods running in the Splunk UI by selecting the <strong>WORKLOADS</strong> tab. This should give you an overview of the workloads on your cluster.</p>
<p><img src=../../../images/k8s-workloads.png alt="Workload Agent"></p>
<p>Note the single agent container running per node among the default Kubernetes pods. This single container will monitor all the pods and services being deployed on this node!</p>
<p>Now switch back to the default cluster node view by selecting the <strong>MAP</strong> tab and select your cluster again.</p>
<p>In your AWS/EC2 or Multipass shell session change into the <code>nginx</code> directory:</p>
<ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item>
<a class="nav-link active tab-Change-Directory" id=tabs-0-0-tab data-toggle=tab href=#tabs-0-0 role=tab onclick='handleClick("Change-Directory")' aria-controls=tabs-0-0 aria-selected=true>
Change Directory
</a>
</li></ul>
<div class=tab-content id=tabs-0-content><div class="tab-pane fade show active" id=tabs-0-0 role=tabpanel aria-labelled-by=tabs-0-0-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>cd</span> ~/workshop/k3s/nginx</code></pre></div></div>
</div>
<hr>
<h2 id=2-create-nginx-deployment>2. Create NGINX deployment</h2>
<p>Create the NGINX <code>configmap</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using the <code>nginx.conf</code> file:</p>
<ul class="nav nav-tabs" id=tabs-1 role=tablist><li class=nav-item>
<a class="nav-link active tab-Kubectl-Configmap-Create" id=tabs-1-0-tab data-toggle=tab href=#tabs-1-0 role=tab onclick='handleClick("Kubectl-Configmap-Create")' aria-controls=tabs-1-0 aria-selected=true>
Kubectl Configmap Create
</a>
</li><li class=nav-item>
<a class="nav-link tab-Kubectl-Create-Configmap-Output" id=tabs-1-1-tab data-toggle=tab href=#tabs-1-1 role=tab onclick='handleClick("Kubectl-Create-Configmap-Output")' aria-controls=tabs-1-1 aria-selected=false>
Kubectl Create Configmap Output
</a>
</li></ul>
<div class=tab-content id=tabs-1-content><div class="tab-pane fade show active" id=tabs-1-0 role=tabpanel aria-labelled-by=tabs-1-0-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl create configmap nginxconfig --from-file<span style=color:#ce5c00;font-weight:700>=</span>nginx.conf</code></pre></div></div>
<div class="tab-pane fade" id=tabs-1-1 role=tabpanel aria-labelled-by=tabs-1-1-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>configmap/nginxconfig created</code></pre></div></div>
</div>
<p>Then create the deployment:</p>
<ul class="nav nav-tabs" id=tabs-2 role=tablist><li class=nav-item>
<a class="nav-link active tab-Kubectl-Create-Deployment" id=tabs-2-0-tab data-toggle=tab href=#tabs-2-0 role=tab onclick='handleClick("Kubectl-Create-Deployment")' aria-controls=tabs-2-0 aria-selected=true>
Kubectl Create Deployment
</a>
</li><li class=nav-item>
<a class="nav-link tab-Kubectl-Create-Deployment-Output" id=tabs-2-1-tab data-toggle=tab href=#tabs-2-1 role=tab onclick='handleClick("Kubectl-Create-Deployment-Output")' aria-controls=tabs-2-1 aria-selected=false>
Kubectl Create Deployment Output
</a>
</li></ul>
<div class=tab-content id=tabs-2-content><div class="tab-pane fade show active" id=tabs-2-0 role=tabpanel aria-labelled-by=tabs-2-0-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl create -f nginx-deployment.yaml</code></pre></div></div>
<div class="tab-pane fade" id=tabs-2-1 role=tabpanel aria-labelled-by=tabs-2-1-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>deployment.apps/nginx created
service/nginx created</code></pre></div></div>
</div>
<p>Next we will deploy Locust<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which is an open source tool used for creating a load test against NGINX:</p>
<ul class="nav nav-tabs" id=tabs-3 role=tablist><li class=nav-item>
<a class="nav-link active tab-Kubectl-Create-Deployment" id=tabs-3-0-tab data-toggle=tab href=#tabs-3-0 role=tab onclick='handleClick("Kubectl-Create-Deployment")' aria-controls=tabs-3-0 aria-selected=true>
Kubectl Create Deployment
</a>
</li><li class=nav-item>
<a class="nav-link tab-Kubectl-Create-Deployment-Output" id=tabs-3-1-tab data-toggle=tab href=#tabs-3-1 role=tab onclick='handleClick("Kubectl-Create-Deployment-Output")' aria-controls=tabs-3-1 aria-selected=false>
Kubectl Create Deployment Output
</a>
</li></ul>
<div class=tab-content id=tabs-3-content><div class="tab-pane fade show active" id=tabs-3-0 role=tabpanel aria-labelled-by=tabs-3-0-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl create -f locust-deployment.yaml</code></pre></div></div>
<div class="tab-pane fade" id=tabs-3-1 role=tabpanel aria-labelled-by=tabs-3-1-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>deployment.apps/nginx-loadgenerator created
service/nginx-loadgenerator created</code></pre></div></div>
</div>
<p>Validate the deployment has been successful and that the Locust and NGINX pods are running.</p>
<p>If you have the Splunk UI open you should see new Pods being started and containers being deployed.</p>
<p>It should only take around 20 seconds for the pods to transition into a Running state. In the Splunk UI you will have a cluster that looks like below:</p>
<p><img src=../../../images/cluster.png alt="back to Cluster"></p>
<p>If you select the <strong>WORKLOADS</strong> tab again you will now see that there is a new ReplicaSet and a deployment added for NGINX:</p>
<p><img src=../../../images/k8s-workloads-nginx.png alt="NGINX loaded"></p>
<hr>
<p>Let&rsquo;s validate this in your shell as well:</p>
<ul class="nav nav-tabs" id=tabs-4 role=tablist><li class=nav-item>
<a class="nav-link active tab-Kubectl-Get-Pods" id=tabs-4-0-tab data-toggle=tab href=#tabs-4-0 role=tab onclick='handleClick("Kubectl-Get-Pods")' aria-controls=tabs-4-0 aria-selected=true>
Kubectl Get Pods
</a>
</li><li class=nav-item>
<a class="nav-link tab-Kubectl-Get-Pods-Output" id=tabs-4-1-tab data-toggle=tab href=#tabs-4-1 role=tab onclick='handleClick("Kubectl-Get-Pods-Output")' aria-controls=tabs-4-1 aria-selected=false>
Kubectl Get Pods Output
</a>
</li></ul>
<div class=tab-content id=tabs-4-content><div class="tab-pane fade show active" id=tabs-4-0 role=tabpanel aria-labelled-by=tabs-4-0-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get pods</code></pre></div></div>
<div class="tab-pane fade" id=tabs-4-1 role=tabpanel aria-labelled-by=tabs-4-1-tab><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME                                                          READY   STATUS    RESTARTS   AGE
splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk   1/1     Running   0          9m19s
splunk-otel-collector-agent-249rd                             1/1     Running   0          9m19s
svclb-nginx-vtnzg                                             1/1     Running   0          5m57s
nginx-7b95fb6b6b-7sb9x                                        1/1     Running   0          5m57s
nginx-7b95fb6b6b-lnzsq                                        1/1     Running   0          5m57s
nginx-7b95fb6b6b-hlx27                                        1/1     Running   0          5m57s
nginx-7b95fb6b6b-zwns9                                        1/1     Running   0          5m57s
svclb-nginx-loadgenerator-nscx4                               1/1     Running   0          2m20s
nginx-loadgenerator-755c8f7ff6-x957q                          1/1     Running   0          2m20s</code></pre></div></div>
</div>
<hr>
<h2 id=3-run-locust-load-test>3. Run Locust load test</h2>
<p>Locust, an open source load generator, is available on port 8080 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://{==EC2-IP==}:8080/</code>, you will then be able to see the Locust running.</p>
<p><img src=../../../images/nginx-locust.png alt=Locust></p>
<p>Set the <strong>Spawn rate</strong> to be 2 and click <strong>Start Swarming</strong>.</p>
<p><img src=../../../images/nginx-locust-spawn-rate.png alt="Locust Spawn Rate"></p>
<p>This will start a gentle continuous load on the application.</p>
<p><img src=../../../images/nginx-locust-statistics.png alt="Locust Statistics"></p>
<p>As you can see from the above screenshot, most of the calls will report a fail, this is expected, as we have not yet deployed the application behind it, however NGINX is reporting on your attempts and you should be able to see those metrics.</p>
<p>Validate you are seeing those metrics in the UI by selecting <strong>Dashboards → Built-in Dashboard Groups → NGINX → NGINX Servers</strong>. Using the <strong>Overrides</strong> filter on <code>k8s.cluster.name:</code>, find the name of your cluster as returned by <code>echo $(hostname)-k3s-cluster</code> in the terminal.</p>
<p><img src=../../../images/nginx-dashboard.png alt="NGINX Dashboard"></p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume. A ConfigMap allows you to decouple environment-specific configuration from your container images, so that your applications are easily portable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p><a href=https://locust.io/ target=_blank>What is Locust?</a>
&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel=noopener href=https://twitter.com/splunk aria-label=Twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/signalfx/observability-workshop aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 Splunk Inc. All Rights Reserved</small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/observability-workshop/v4.35/js/tabpane-persist.js></script>
<script src=/observability-workshop/v4.35/js/main.min.8ab8f81ff7e1454d30024cd6f956d4d341c3a97e2a673f988065f2ee4e147922.js integrity="sha256-irj4H/fhRU0wAkzW+VbU00HDqX4qZz+YgGXy7k4UeSI=" crossorigin=anonymous></script>
<script>const svgCopy='<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg>',svgCheck='<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" fill="rgb(63, 185, 80)" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>',addCopyButtons=a=>{document.querySelectorAll("pre > code").forEach(c=>{const b=document.createElement("button");b.className="clipboard-button",b.type="button",b.innerHTML=svgCopy,b.addEventListener("click",()=>{a.writeText(c.innerText).then(()=>{b.blur(),b.innerHTML=svgCheck,setTimeout(()=>b.innerHTML=svgCopy,2e3)},a=>b.innerHTML="Error")});const d=c.parentNode;d.parentNode.insertBefore(b,d)})};if(navigator&&navigator.clipboard)addCopyButtons(navigator.clipboard);else{const a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",a.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",a.crossOrigin="anonymous",a.onload=()=>addCopyButtons(clipboard),document.body.appendChild(a)}</script>
</body>
</html>