<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Splunk Observability Cloud Workshops – Online Boutique K8s Workshop</title><link>https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/</link><description>Recent content in Online Boutique K8s Workshop on Splunk Observability Cloud Workshops</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/index.xml" rel="self" type="application/rss+xml"/><item><title>Apm: K3s環境にOnline Boutiqueをデプロイする</title><link>https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/deploy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/deploy/</guid><description>
&lt;ul>
&lt;li>Online BoutiqueアプリケーションをKubernetes(K3s)にデプロイします&lt;/li>
&lt;li>アプリケーションが動作していることを確認します&lt;/li>
&lt;li>Locustを使って人工的なトラフィックを生成します&lt;/li>
&lt;li>UI で APM のメトリクスを見ましょう&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="1-ec2サーバーを確認">1. EC2サーバーを確認&lt;/h2>
&lt;p>これからの操作は、IMワークショップを実行した後で、まだEC2インスタンスにアクセスできる状態であることを想定しています。
もしアクセスできる場合は、3. &lt;em>オンラインブティック&lt;/em> に進みます。
新しいインスタンスを受け取った場合は、 &lt;a href="../../../../imt/docs/gdi/k3s">Deploying the OpenTelemetry Collector in Kubernetes&lt;/a>
の最初の2つのセクションを実行して、システムをAPMワークショップのために準備し、次のセクションを続行してください。&lt;/p>
&lt;h2 id="2-online-boutiqueをデプロイする">2. Online Boutiqueをデプロイする&lt;/h2>
&lt;p>Online BoutiqueアプリケーションをK3sにデプロイするには、以下のデプロイメントを適用します。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-00-00-tab" data-toggle="tab" href="#tabs-00-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-00-00" aria-selected="false">
Deploy Online Boutique
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-00-01-tab" data-toggle="tab" href="#tabs-00-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-00-01" aria-selected="false">
Deployment Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-0-content">
&lt;div class="tab-pane fade show active"
id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">cd&lt;/span> ~/workshop/apm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./apm-config.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f deployment.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>APM Only Deployment
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/recommendationservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/recommendationservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/productcatalogservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/productcatalogservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/cartservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/cartservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/adservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/adservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/paymentservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/paymentservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/loadgenerator created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/loadgenerator created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/shippingservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/shippingservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/currencyservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/currencyservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/redis-cart created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/redis-cart created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/checkoutservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/checkoutservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/frontend created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/frontend created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/frontend-external created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/emailservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/emailservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/rum-loadgen-deployment created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="alert alert-warning" role="alert">
&lt;p class="alert-heading">変数未セットに関するメッセージが表示された場合&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
&lt;strong>kubectl delete -f deployment.yaml&lt;/strong> コマンドを実行しAPM環境のデプロイ削除します。
次にガイド、メッセージに表示されていた変数をexportし上記のデプロイスクリプトを再実行します。
&lt;/p>
&lt;/div>
&lt;/div>
&lt;p>Online Boutique アプリケーションが起動していることを確認するには:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-2" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-02-00-tab" data-toggle="tab" href="#tabs-02-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-02-00" aria-selected="false">
Get Pods
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-02-01-tab" data-toggle="tab" href="#tabs-02-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-02-01" aria-selected="false">
Get Pods Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-2-content">
&lt;div class="tab-pane fade show active"
id="tabs-02-00" role="tabpanel" aria-labelled-by="tabs-02-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl get pods&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-02-01" role="tabpanel" aria-labelled-by="tabs-02-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-k8s-cluster-receiver-56585564cc-xclzj 1/1 Running 0 84s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-agent-hkshj 1/1 Running 0 84s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>svclb-frontend-external-c74n6 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>currencyservice-747b74467f-xxrl9 1/1 Running 0 52s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis-cart-74594bd569-2jb6c 1/1 Running 0 54s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>adservice-6fb948b8c6-2xlrc 0/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>recommendationservice-b5df8776c-sbt4h 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>shippingservice-6d6f7b8d87-5lg9g 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>svclb-loadgenerator-jxwct 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>emailservice-9dd74d87c-wjdqr 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>checkoutservice-8bcd56b46-bfj7d 1/1 Running 0 54s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>productcatalogservice-796cdcc5f5-vhspz 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paymentservice-6c875bf647-dklzb 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>frontend-b8f747b87-4tkxn 1/1 Running 0 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cartservice-59d5979db7-bqf64 1/1 Running 1 53s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>loadgenerator-57c8b84966-7nr4f 1/1 Running 3 53s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="alert alert-info" role="alert">
&lt;p class="alert-heading">Info&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
通常、ポッドがRunning状態に移行するのに1分30秒程度かかります。
&lt;/p>
&lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 id="3-uiで検証する">3. UIで検証する&lt;/h2>
&lt;p>Splunk UIでInfrastructure &lt;img src="../../../images/infrastructure.png" alt="infrastructure button"> をクリックします。Infrastructure Overviewダッシュボードに遷移しますので、 &lt;strong>Kubernetes&lt;/strong> をクリックします。&lt;/p>
&lt;p>&lt;strong>Cluster&lt;/strong> のドロップダウンを使用してクラスタを選択すると、新しいポッドが開始され、コンテナがデプロイされていることが確認できます。&lt;/p>
&lt;p>Splunk UI で Cluster をクリックすると、次のような画面が表示されているはずです。&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-k8s.png" alt="back to Cluster">&lt;/p>
&lt;p>もう一度 &lt;strong>WORKLOADS&lt;/strong> タブを選択すると、いくつかのデプロイメントとレプリカセットがあることがわかるはずです。&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-workload.png" alt="HOTROD loaded">&lt;/p>
&lt;hr>
&lt;h2 id="4-online-boutique-を閲覧する">4. Online Boutique を閲覧する&lt;/h2>
&lt;p>Online Boutique は、EC2インスタンスのIPアドレスの81番ポートで閲覧できます。このIPアドレスは、ワークショップの冒頭でインスタンスにSSH接続したときに使用したものと同じIPアドレスです。&lt;/p>
&lt;p>ウェブブラウザを開き、 &lt;code>http://{==EC2-IP==}:81/&lt;/code> にアクセスすると、Online Boutique が起動しているのが確認できます。&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique.png" alt="Online Boutique">&lt;/p></description></item><item><title>Apm: Locustでトラフィックを発生させる</title><link>https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/locust/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.51/ja/apm/docs/online-boutique/locust/</guid><description>
&lt;h2 id="1-トラフィックを発生させる">1. トラフィックを発生させる&lt;/h2>
&lt;p>Online Boutique のデプロイメントには、Locust が動作するコンテナが含まれており、これを使用してウェブサイトに対する負荷トラフィックを生成し、メトリクス、トレース、スパンを生成することができます。&lt;/p>
&lt;p>Locust は、EC2インスタンスのIPアドレスの82番ポートで利用できます。ウェブブラウザで新しいタブを開き、 &lt;code>http://{==EC2-IP==}:82/&lt;/code> にアクセスすると、Locust が動作しているのが確認できます。&lt;/p>
&lt;p>&lt;img src="../../../images/locust.png" alt="Locust">&lt;/p>
&lt;p>&lt;strong>Spawn rate&lt;/strong> を 2 に設定し、&lt;strong>Start Swarming&lt;/strong> をクリックすると、アプリケーションに緩やかな負荷がかかり続けます。&lt;/p>
&lt;p>&lt;img src="../../../images/locust-spawn-rate.png" alt="Spawn Rate">&lt;/p>
&lt;p>&lt;img src="../../../images/locust-statistics.png" alt="Statistics">&lt;/p>
&lt;hr>
&lt;p>それでは、&lt;strong>&lt;img src="../../../images/dashboards.png" alt="dashboards button"> Dashboards → All Dashboards → APM Services → Service&lt;/strong> を開きましょう。&lt;/p>
&lt;p>このためには、アプリケーションの Environment 名を知る必要があります。このワークショップでは、&lt;code>{==hostname==}-apm-env&lt;/code> のような Environment 名で定義されています。&lt;/p>
&lt;p>ホスト名を調べるには、AWS/EC2インスタンス上で以下のコマンドを実行します:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-00-00-tab" data-toggle="tab" href="#tabs-00-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-00-00" aria-selected="false">
Echo Hostname
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-00-01-tab" data-toggle="tab" href="#tabs-00-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-00-01" aria-selected="false">
Output Example
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-0-content">
&lt;div class="tab-pane fade show active"
id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>hostname&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>-apm-env&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>bdzx-apm-env&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>前のステップで見つけた Environment を選択し、「frontend」サービスを選択し、時間を「Past 15 minutes」に設定します。&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-service-dashboard.png" alt="APM Dashboard">&lt;/p>
&lt;p>この自動生成されたダッシュボードでは、RED (Rate, Error &amp;amp; Duration) メトリクスを使用して、サービスの状態を監視することができます。このダッシュボードでは、パフォーマンスに関連したさまざまなチャートのほか、基盤となるホストやKubernetesポッド（該当する場合）の相関情報も提供されます。&lt;/p>
&lt;p>ダッシュボードの様々なチャートを見てみましょう。&lt;/p>
&lt;hr>
&lt;h2 id="2-splunk-apm-のメトリクスを確認する">2. Splunk APM のメトリクスを確認する&lt;/h2>
&lt;p>画面左のメニューから「APM」 &lt;img src="../../../images/apm.png" alt="apm button"> をクリックするとAPM Overviewダッシュボードが表示されます。&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-apm.png" alt="select APM">&lt;/p>
&lt;p>右側の &lt;strong>Explore&lt;/strong> を選択し、先ほど見つけた Environment を選択し、時間を15分に設定します。これにより、自動的に生成されたOnline BoutiqueアプリケーションのDependency/Service Mapが表示されます。&lt;/p>
&lt;p>以下のスクリーンショットのように表示されます:&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-map.png" alt="Online Boutique in APM">&lt;/p>
&lt;p>ページの下部にある凡例では、依存関係/サービスマップでの表記について説明しています。&lt;/p>
&lt;p>&lt;img src="../../../images/apm-legend.png" alt="APM Legend">&lt;/p>
&lt;ul>
&lt;li>サービスリクエスト、エラーレート、ルートエラーレート。&lt;/li>
&lt;li>リクエストレート、レイテンシー、エラーレート&lt;/li>
&lt;/ul>
&lt;p>また、このビューでは、全体的なエラー率とレイテンシー率のタイムチャートを見ることができます。&lt;/p>
&lt;h2 id="3-opentelemetry-ダッシュボード">3. OpenTelemetry ダッシュボード&lt;/h2>
&lt;p>Open Telemetery Collector がデプロイされると、プラットフォームは自動的に OpenTelemetry Collector のメトリクスを表示するダッシュボードを作成します。&lt;/p>
&lt;p>左上のハンバーガーメニューから、 &lt;img src="../../../images/dashboards.png" alt="dashboards button"> &lt;strong>Dashboards → OpenTelemetry Collector&lt;/strong> を選択し、メトリクスとスパンが送信されていることを確認しましょう。&lt;/p>
&lt;p>&lt;img src="../../../images/otel-dashboard.png" alt="OpenTelemetry Collector dashboard">&lt;/p>
&lt;h2 id="4-opentelemetry-zpages">4. OpenTelemetry zpages&lt;/h2>
&lt;p>送信されたトレースをデバッグするには、zpages 拡張機能を使用できます。&lt;a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/experimental/trace/zpages.md#tracez" target="_blank">zpages&lt;/a>
は OpenTelemetry Collector の一種で、トラブルシューティングや統計用のライブデータを提供します。これらは、EC2インスタンスのIPアドレスのポート &lt;code>55679&lt;/code> で利用できます。Webブラウザで新しいタブを開き、 &lt;code>http://{==EC2-IP==}:55679/debug/tracez&lt;/code> と入力すると、zpages の出力を見ることができます。&lt;/p>
&lt;p>&lt;img src="../../../images/zpages.png" alt="zpages">&lt;/p>
&lt;p>また、シェルプロンプトから、テキストベースのブラウザを実行することもできます。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-1" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-text"
id="tabs-01-00-tab" data-toggle="tab" href="#tabs-01-00" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-01-00" aria-selected="false">
Lynx Command
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-1-content">
&lt;div class="tab-pane fade show active"
id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>lynx http://localhost:55679/debug/tracez&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div></description></item></channel></rss>