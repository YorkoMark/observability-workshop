<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.11.2+tip"><meta name=description content="Splunk Observability Workshops"><title>Root Cause Analysis :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.57/tko/session-6/docs/root_cause/index.html rel=canonical type=text/html title="Root Cause Analysis :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.57/tko/session-6/docs/root_cause/index.xml rel=alternate type=application/rss+xml title="Root Cause Analysis :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.57/images/favicon.ico?1676480222 rel=icon type=image/x-icon><link href=https://splunk.github.io/observability-workshop/v4.57/css/fontawesome-all.min.css?1676480224 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/fontawesome-all.min.css?1676480224 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/auto-complete.css?1676480224 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/auto-complete.css?1676480224 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/perfect-scrollbar.min.css?1676480224 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.57/css/nucleus.css?1676480224 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.57/css/fonts.css?1676480224 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/fonts.css?1676480224 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.57/css/theme.css?1676480224 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.57/css/theme-splunk-light.css?1676480224 rel=stylesheet id=variant-style><link href=https://splunk.github.io/observability-workshop/v4.57/css/ie.css?1676480224 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.57/css/variant.css?1676480224 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.57/css/print.css?1676480224 rel=stylesheet media=print><link href=https://splunk.github.io/observability-workshop/v4.57/css/format-print.css?1676480224 rel=stylesheet><script src=https://splunk.github.io/observability-workshop/v4.57/js/url.js?1676480224></script>
<script src=https://splunk.github.io/observability-workshop/v4.57/js/variant.js?1676480224></script>
<script>window.index_js_url="https://splunk.github.io/observability-workshop/v4.57/index.search.js";var root_url="https://splunk.github.io/observability-workshop/v4.57/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.57/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=https://splunk.github.io/observability-workshop/v4.57/tko/session-6/docs/root_cause/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable dir=ltr><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.57/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.57/tko/index.html><span itemprop=name>TKO Workshops</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.57/tko/session-6/index.html><span itemprop=name>6. O11y - Distributed Tracing for modern applications</span></a><meta itemprop=position content="3">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Root Cause Analysis</span><meta itemprop=position content="4"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=root-cause-analysis>Root Cause Analysis</h1><h2 id=1-latency-root-cause>1. Latency Root Cause</h2><p>Open Service Map in Splunk Observability UI</p><p><a href=#image-a00d3c82de26148367b74a9970806d92 class=lightbox-link><img src=https://user-images.githubusercontent.com/32849847/206542093-f97b37ce-7e58-45bc-a281-5a388d60617e.png alt="Screen Shot 2022-12-08 at 11 48 58 AM" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a00d3c82de26148367b74a9970806d92><img src=https://user-images.githubusercontent.com/32849847/206542093-f97b37ce-7e58-45bc-a281-5a388d60617e.png alt="Screen Shot 2022-12-08 at 11 48 58 AM" class=lightbox-image loading=lazy></a></p><p>We can see we still have our original Latency issue, however our exception for Invalid Locale should be gone.</p><p>Let&rsquo;s check to see our InvalidLocale Exception is gone. Click Shop Service, click Traces on the right. We did remove the exception however it seems removing the Exception did not fix the latency&mldr;</p><p>Lets see if the newly added annotations provide us more relevant information for the next responder once we find the cause.</p><div class="box notices cstyle default" style=--VARIABLE-BOX-color:warning><div class=box-label>Note:</div><div class=box-content><p>We added additional information Parameter Values at Time of Latency. In this case the <strong>Location</strong> tag was created due our handy Annotator, that did the <a href=https://opentelemetry.io/docs/instrumentation/java/automatic/annotations/ target=_blank>OpenTelemetry Annotations</a></p></div></div><p><a href=#image-4f3cbf02f960c0f3d511dcd48a771bf5 class=lightbox-link><img src=https://user-images.githubusercontent.com/32849847/213582624-66466a19-00fa-4dda-acd0-f6970d594ba1.png alt=image style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4f3cbf02f960c0f3d511dcd48a771bf5><img src=https://user-images.githubusercontent.com/32849847/213582624-66466a19-00fa-4dda-acd0-f6970d594ba1.png alt=image class=lightbox-image loading=lazy></a></p><p>We can see that the actual function call that has the latency was not <code>ProductResource.getAllProducts</code> but the function call <code>ProductResource.myCoolFunction234234234</code>!</p><p>With this information a Developer can debug very quickly. Consider the case of debugging code, that you may not have written yourself without Parameter Values at the time of the issue? You would have no choice but to go line &mldr;. by line &mldr;.. by line&mldr;.. which can take a very long time.</p><p>Since we now have the parameter tagged as part of our span metadata the actual root cause is seemingly related to the &ldquo;location&rdquo; Colorado!</p><p>It appears the one custom attribute that was tagged for function <code>ProductResource.myCoolFunction234234234</code> was <code>myInt</code> with a value of <code>999</code>.</p><p>Let&rsquo;s see if we can find the code that is causing this latency.</p><h2 id=2-fix-the-code>2. Fix the code</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java
</span></span></code></pre></div><p>search for 999 <code>/999</code></p><p>We found and fixed the Needle In Haystack more quickly! Let&rsquo;s fix our code, enter <code>i</code> for insert.</p><p>Change this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>myCoolFunction234234234</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@SpanAttribute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;myInt&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>myInt</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Generate a FAST sleep of 0 time !
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>Random</span> <span style=color:#000>sleepy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Random</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>999</span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#000>myInt</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Thread</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sleepy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>nextInt</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5000</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>3000</span><span style=color:#ce5c00;font-weight:700>)</span>  <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>3000</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span></code></pre></div><p>To this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>myCoolFunction234234234</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@SpanAttribute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;myInt&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>myInt</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Generate a FAST sleep of 0 time !
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>Random</span> <span style=color:#000>sleepy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Random</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>//    if (999==myInt)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//        Thread.sleep(sleepy.nextInt(5000 - 3000) + 3000);
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span></code></pre></div><p>Save changes in vi type <code>:wq</code></p><p>Make sure you saved your changes to: <code>products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</code></p><footer class=footline></footer></article></div></main></div><script src=https://splunk.github.io/observability-workshop/v4.57/js/clipboard.min.js?1676480224 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.57/js/perfect-scrollbar.min.js?1676480224 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.57/js/theme.js?1676480224 defer></script></body></html>