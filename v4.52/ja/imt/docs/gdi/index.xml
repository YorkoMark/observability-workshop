<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Splunk Observability Cloud Workshops – データを取り込む</title><link>https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/</link><description>Recent content in データを取り込む on Splunk Observability Cloud Workshops</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/index.xml" rel="self" type="application/rss+xml"/><item><title>Imt: Kubernetes環境にOpenTelemetry Collectorをデプロイする</title><link>https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/k3s/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/k3s/</guid><description>
&lt;ul>
&lt;li>Splunk Helm chartを使用して、K3s に OpenTelemetry Collector をインストールします&lt;/li>
&lt;li>Kubernetes Navigatorでクラスタを探索します&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="1-access-tokenの取得">1. Access Tokenの取得&lt;/h2>
&lt;p>Kubernetes が起動したら、Splunk の UI から Access Token&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> を取得する必要があります。Access Token は、左下にある &lt;strong>&amp;raquo;&lt;/strong> を開き、 &lt;strong>Settings → Access Tokens&lt;/strong> を選択すると表示されます。&lt;/p>
&lt;p>主催者が指示したワークショップトークン（例： &lt;strong>O11y-Workshop-ACCESS&lt;/strong> 等）を開き、 &lt;strong>Show Token&lt;/strong> をクリックしてトークンを公開します。
&lt;strong class="label-button ui-button-grey" role="label-button">
Copy
&lt;/strong>
&amp;nbsp; ボタンをクリックし、クリップボードにコピーしてください。 &lt;strong>Default&lt;/strong> のトークンは使用しないでください。&lt;/p>
&lt;p>&lt;img src="../../../images/access-token.png" alt="Access Token">&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;p class="alert-heading">独自のトークンを新たに作成しないようにしてください&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
このワークショップのために設定のトークンを作成し、IngestとAPIの両方の権限を割り当てています。実運用でのベストプラクティスは、1つのTokenにはIngestまたはAPIまたはRUMのような単一のパーミッションを割り当て、必要な場合は複数のトークンを使用することです。
&lt;/p>
&lt;/div>
&lt;/div>
&lt;p>また、Splunk アカウントの Realm&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup> の名前を取得する必要があります。サイドメニューの最上部の名前をクリックし、&lt;strong>Account Settings&lt;/strong> ページに移動します。Organizations タブをクリックします。Realm はページの中央に表示されています。 この例では「us0」となっています。&lt;/p>
&lt;p>&lt;img src="../../../images/account-settings.png" alt="Account Settings">&lt;/p>
&lt;h2 id="2-helmによるインストール">2. Helmによるインストール&lt;/h2>
&lt;p>環境変数 &lt;code>ACCESS_TOKEN&lt;/code> と &lt;code>REALM&lt;/code> を作成して、進行中の Helm のインストールコマンドで使用します。例えば、Realm が &lt;code>us1&lt;/code> の場合は、&lt;code>export REALM=us1&lt;/code> と入力し、&lt;code>eu0&lt;/code> の場合は、&lt;code>export REALM=eu0&lt;/code> と入力します。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-2" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-02-00-tab" data-toggle="tab" href="#tabs-02-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-02-00" aria-selected="false">
Export ACCESS TOKEN
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-2-content">
&lt;div class="tab-pane fade show active"
id="tabs-02-00" role="tabpanel" aria-labelled-by="tabs-02-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">ACCESS_TOKEN&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;lt;replace_with_O11y-Workshop-ACCESS_TOKEN&amp;gt;&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;ul class="nav nav-tabs" id="tabs-3" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-03-00-tab" data-toggle="tab" href="#tabs-03-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-03-00" aria-selected="false">
Export REALM
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-3-content">
&lt;div class="tab-pane fade show active"
id="tabs-03-00" role="tabpanel" aria-labelled-by="tabs-03-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">REALM&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;lt;replace_with_REALM&amp;gt;&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>Splunk Helm チャートを使って OpenTelemetry Collector をインストールします。まず、Splunk Helm chart のリポジトリを Helm に追加してアップデートします。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-4" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-04-00-tab" data-toggle="tab" href="#tabs-04-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-04-00" aria-selected="false">
Helm Repo Add
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-04-01-tab" data-toggle="tab" href="#tabs-04-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-04-01" aria-selected="false">
Helm Repo Add Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-4-content">
&lt;div class="tab-pane fade show active"
id="tabs-04-00" role="tabpanel" aria-labelled-by="tabs-04-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> helm repo update&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-04-01" role="tabpanel" aria-labelled-by="tabs-04-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>Using ACCESS_TOKEN={REDACTED}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using REALM=eu0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;#34;splunk-otel-collector-chart&amp;#34; has been added to your repositories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using ACCESS_TOKEN={REDACTED}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using REALM=eu0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Hang tight while we grab the latest from your chart repositories...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...Successfully got an update from the &amp;#34;splunk-otel-collector-chart&amp;#34; chart repository
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Update Complete. ⎈Happy Helming!⎈&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>以下のコマンドでOpenTelemetry Collector Helmチャートをインストールします。これは &lt;strong>変更しないでください&lt;/strong>。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-5" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-05-00-tab" data-toggle="tab" href="#tabs-05-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-05-00" aria-selected="false">
Helm Install
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-05-01-tab" data-toggle="tab" href="#tabs-05-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-05-01" aria-selected="false">
Helm Install Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-5-content">
&lt;div class="tab-pane fade show active"
id="tabs-05-00" role="tabpanel" aria-labelled-by="tabs-05-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>helm install splunk-otel-collector &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;splunkObservability.realm=&lt;/span>&lt;span style="color:#000">$REALM&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;splunkObservability.accessToken=&lt;/span>&lt;span style="color:#000">$ACCESS_TOKEN&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;clusterName=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>hostname&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">-k3s-cluster&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;splunkObservability.logsEnabled=true&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;splunkObservability.profilingEnabled=true&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>--set&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;environment=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>hostname&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">-apm-env&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>splunk-otel-collector-chart/splunk-otel-collector &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span>-f ~/workshop/k3s/otel-collector.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-05-01" role="tabpanel" aria-labelled-by="tabs-05-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>Using ACCESS_TOKEN={REDACTED}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Using REALM=eu0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME: splunk-otel-collector
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LAST DEPLOYED: Fri May 7 11:19:01 2021
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAMESPACE: default
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>STATUS: deployed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>REVISION: 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TEST SUITE: None&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>約30秒程度待ってから &lt;code>kubectl get pods&lt;/code> を実行すると、新しいポッドが稼働していることが報告され、デプロイメントの進捗を監視することができます。&lt;/p>
&lt;p>続行する前に、ステータスがRunningと報告されていることを確認してください。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-6" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-06-00-tab" data-toggle="tab" href="#tabs-06-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-06-00" aria-selected="false">
Kubectl Get Pods
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-06-01-tab" data-toggle="tab" href="#tabs-06-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-06-01" aria-selected="false">
Kubectl Get Pods Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-6-content">
&lt;div class="tab-pane fade show active"
id="tabs-06-00" role="tabpanel" aria-labelled-by="tabs-06-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get pods&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-06-01" role="tabpanel" aria-labelled-by="tabs-06-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-agent-2sk6k 0/1 Running 0 10s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-k8s-cluster-receiver-6956d4446f-gwnd7 0/1 Running 0 10s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>OpenTelemetry Collector podのログを確認して、エラーがないことを確認します。出力は、以下の出力例にあるログに似ているはずです。&lt;/p>
&lt;p>ログを確認するには、&lt;code>helm&lt;/code> のインストールで設定したラベルを使用してください（終了するには &lt;strong>ctrl+c&lt;/strong> を押します）。もしくは、インストールされている &lt;code>k9s&lt;/code> ターミナル UI を使うとボーナスポイントがもらえます！&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-7" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-07-00-tab" data-toggle="tab" href="#tabs-07-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-07-00" aria-selected="false">
Kubectl Logs
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-07-01-tab" data-toggle="tab" href="#tabs-07-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-07-01" aria-selected="false">
Kubectl Logs Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-7-content">
&lt;div class="tab-pane fade show active"
id="tabs-07-00" role="tabpanel" aria-labelled-by="tabs-07-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl logs -l &lt;span style="color:#000">app&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>splunk-otel-collector -f --container otel-collector&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-07-01" role="tabpanel" aria-labelled-by="tabs-07-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:10.900Z INFO service/service.go:364 Starting receivers...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:10.900Z INFO builder/receivers_builder.go:70 Receiver is starting... {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;prometheus&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;prometheus&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;prometheus&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;prometheus&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:70 Receiver is starting... {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;k8s_cluster&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO k8sclusterreceiver@v0.21.0/watcher.go:195 Configured Kubernetes MetadataExporter {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;exporter_name&amp;#34;: &amp;#34;signalfx&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;k8s_cluster&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO healthcheck/handler.go:128 Health Check state change {&amp;#34;component_kind&amp;#34;: &amp;#34;extension&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;health_check&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;health_check&amp;#34;, &amp;#34;status&amp;#34;: &amp;#34;ready&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO service/service.go:267 Everything is ready. Begin running and processing data.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.009Z INFO k8sclusterreceiver@v0.21.0/receiver.go:59 Starting shared informers and wait for initial cache sync. {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;k8s_cluster&amp;#34;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>2021-03-21T16:11:11.281Z INFO k8sclusterreceiver@v0.21.0/receiver.go:75 Completed syncing shared informer caches. {&amp;#34;component_kind&amp;#34;: &amp;#34;receiver&amp;#34;, &amp;#34;component_type&amp;#34;: &amp;#34;k8s_cluster&amp;#34;, &amp;#34;component_name&amp;#34;: &amp;#34;k8s_cluster&amp;#34;}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="alert alert-info" role="alert">
&lt;p class="alert-heading">インストールに失敗した場合に削除する&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
OpenTelemetry Collectorのインストールに失敗した場合は、次のようにしてインストールを削除することで、最初からやり直すことができます。
&lt;strong>helm delete splunk-otel-collector&lt;/strong>
&lt;/p>
&lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 id="3-ui-でメトリクスを確認する">3. UI でメトリクスを確認する&lt;/h2>
&lt;p>Splunk の UI で左下の &lt;strong>&amp;raquo;&lt;/strong> を開いて &lt;strong>Infrastructure&lt;/strong> をクリックします。&lt;/p>
&lt;p>&lt;img src="../../../images/clustermap-nav.png" alt="Kubernetes Navigator Mapの選択">&lt;/p>
&lt;p>&lt;strong>Containers&lt;/strong> の下にある &lt;strong>Kubernetes&lt;/strong> をクリックして Kubernetes Navigator Cluster Map を開き、メトリクスが送信されていることを確認します。&lt;/p>
&lt;p>クラスタが検出され、レポートされていることを確認するには、自分のクラスタを探します（ワークショップでは、他の多くのクラスタが表示されます）。クラスタ名を見つけるには、以下のコマンドを実行し、出力をクリップボードにコピーしてください。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-9" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-09-00-tab" data-toggle="tab" href="#tabs-09-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-09-00" aria-selected="false">
Echo Cluster Name
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-9-content">
&lt;div class="tab-pane fade show active"
id="tabs-09-00" role="tabpanel" aria-labelled-by="tabs-09-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>hostname&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>-k3s-cluster&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>次に、UIで、Splunkロゴのすぐ下にある「Cluster: - 」メニューをクリックし、先程コピーしたクラスタ名を検索ボックスに貼り付け、チェックボックスをクリックしてクラスタを選択し、最後にメニューのその他の部分をクリックしてフィルタを適用します。&lt;/p>
&lt;p>&lt;img src="../../../images/search-k3s-cluster.png" alt="K8S Clusters Filter">&lt;/p>
&lt;p>&lt;img src="../../../images/selecting-k3s-cluster.png" alt="Select K8S Cluster">&lt;/p>
&lt;p>&lt;img src="../../../images/filtered-k3s-cluster.png" alt="Filtered K8S Cluster">&lt;/p>
&lt;p>ノードの状態を確認するには、クラスターの淡いブルーの背景にカーソルを置き、左上に表示される青い虫眼鏡 &lt;img src="../../../images/blue-cross.png" alt="Magnifying Glass"> をクリックしてください 。&lt;/p>
&lt;p>これで、ノードレベルまでドリルダウンできます。 次に、サイドバーボタンをクリックしてサイドバーを開き、Metricsサイドバーを開きます。&lt;/p>
&lt;p>サイドのスライダーを使って、CPU、メモリ、ネットワーク、イベントなど、クラスタ/ノードに関連する様々なチャートを見ることができます。&lt;/p>
&lt;p>&lt;img src="../../../images/explore-metrics.png" alt="Sidebar metrics">&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>Access Tokens (Org Tokensと呼ばれることもあります)は、長期間利用を前提とした組織レベルのトークンです。デフォルトでは、これらのトークンは 5 年間保存されます。そのため、長期間にわたってデータポイントを送信するエミッターに組み込んだり、Splunk API を呼び出す長期的なスクリプトに使用したりするのに適しています。&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>Realm とは、Splunk内部の管理単位ので、その中で組織がホストされます。異なる Realm には異なる API エンドポイントがあります (たとえば、データを送信するためのエンドポイントは、&lt;strong>&lt;code>us1&lt;/code>&lt;/strong> realm では &lt;code>ingest.us1.signalfx.com&lt;/code> 、&lt;strong>&lt;code>eu0&lt;/code>&lt;/strong> レルムでは &lt;code>ingest.eu0.signalfx.com&lt;/code> となります)。このrealm名は、Splunk UI のプロファイルページに表示されます。エンドポイントを指定する際にレルム名を含めない場合、Splunk は &lt;strong>&lt;code>us0&lt;/code>&lt;/strong> レルムを指していると解釈します。&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Imt: K3s に NGINX をデプロイする</title><link>https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/nginx/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.52/ja/imt/docs/gdi/nginx/</guid><description>
&lt;ul>
&lt;li>NGINX ReplicaSet を K3s クラスタにデプロイし、NGINX デプロイメントのディスカバリーを確認します。&lt;/li>
&lt;li>負荷テストを実行してメトリクスを作成し、Splunk Observability Cloudにストリーミングすることを確認します！&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="1-nginx-の起動">1. NGINX の起動&lt;/h2>
&lt;p>Splunk UI で &lt;strong>WORKLOADS&lt;/strong> タブを選択して、実行中の Pod の数を確認します。これにより、クラスタ上のワークロードの概要がわかるはずです。&lt;/p>
&lt;p>&lt;img src="../../../images/k8s-workloads.png" alt="Workload Agent">&lt;/p>
&lt;p>デフォルトの Kubernetes Pod のうち、ノードごとに実行されている単一のエージェントコンテナに注目してください。この1つのコンテナが、このノードにデプロイされているすべての Pod とサービスを監視します！&lt;/p>
&lt;p>次に、&lt;strong>MAP&lt;/strong> タブを選択してデフォルトのクラスタノードビューに戻し、再度クラスタを選択します。&lt;/p>
&lt;p>Multipass または AWS/EC2 のシェルセッションで、&lt;code>nginx&lt;/code> ディレクトリに移動します。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-00-00-tab" data-toggle="tab" href="#tabs-00-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-00-00" aria-selected="false">
Change Directory
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-0-content">
&lt;div class="tab-pane fade show active"
id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">cd&lt;/span> ~/workshop/k3s/nginx&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 id="2-nginxのデプロイメント作成">2. NGINXのデプロイメント作成&lt;/h2>
&lt;p>NGINX の &lt;code>configmap&lt;/code>&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup> を &lt;code>nginx.conf&lt;/code> ファイルを使って作成します。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-1" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-01-00-tab" data-toggle="tab" href="#tabs-01-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-01-00" aria-selected="false">
Kubectl Configmap Create
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-01-01-tab" data-toggle="tab" href="#tabs-01-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-01-01" aria-selected="false">
Kubectl Create Configmap Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-1-content">
&lt;div class="tab-pane fade show active"
id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create configmap nginxconfig --from-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>nginx.conf&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-01-01" role="tabpanel" aria-labelled-by="tabs-01-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>configmap/nginxconfig created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>続いて、デプロイメントを作成します。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-2" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-02-00-tab" data-toggle="tab" href="#tabs-02-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-02-00" aria-selected="false">
Kubectl Create Deployment
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-02-01-tab" data-toggle="tab" href="#tabs-02-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-02-01" aria-selected="false">
Kubectl Create Deployment Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-2-content">
&lt;div class="tab-pane fade show active"
id="tabs-02-00" role="tabpanel" aria-labelled-by="tabs-02-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f nginx-deployment.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-02-01" role="tabpanel" aria-labelled-by="tabs-02-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>deployment.apps/nginx created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/nginx created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>次に、NGINXに対する負荷テストを作成するため、 Locust&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup> をデプロイします。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-3" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-03-00-tab" data-toggle="tab" href="#tabs-03-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-03-00" aria-selected="false">
Kubectl Create Deployment
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-03-01-tab" data-toggle="tab" href="#tabs-03-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-03-01" aria-selected="false">
Kubectl Create Deployment Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-3-content">
&lt;div class="tab-pane fade show active"
id="tabs-03-00" role="tabpanel" aria-labelled-by="tabs-03-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f locust-deployment.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-03-01" role="tabpanel" aria-labelled-by="tabs-03-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>deployment.apps/nginx-loadgenerator created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/nginx-loadgenerator created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>デプロイメントが成功し、Locust と NGINX Pod が動作していることを確認しましょう。&lt;/p>
&lt;p>Splunk UI を開いていれば、新しい Pod が起動し、コンテナがデプロイされているのがわかるはずです。&lt;/p>
&lt;p>Pod が実行状態に移行するまでには 20 秒程度しかかかりません。Splunk UIでは、以下のようなクラスタが表示されます。&lt;/p>
&lt;p>&lt;img src="../../../images/cluster.png" alt="Back to Cluster">&lt;/p>
&lt;p>もう一度 &lt;strong>WORKLOADS&lt;/strong> タブを選択すると、新しい ReplicaSet と NGINX 用のデプロイメントが追加されていることがわかります。&lt;/p>
&lt;p>&lt;img src="../../../images/k8s-workloads-nginx.png" alt="NGINX loaded">&lt;/p>
&lt;hr>
&lt;p>これをシェルでも検証してみましょう。&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-4" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-bash"
id="tabs-04-00-tab" data-toggle="tab" href="#tabs-04-00" role="tab"
onclick="persistLang(&amp;#34;bash&amp;#34;);"aria-controls="tabs-04-00" aria-selected="false">
Kubectl Get Pods
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-04-01-tab" data-toggle="tab" href="#tabs-04-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-04-01" aria-selected="false">
Kubectl Get Pods Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-4-content">
&lt;div class="tab-pane fade show active"
id="tabs-04-00" role="tabpanel" aria-labelled-by="tabs-04-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get pods&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-04-01" role="tabpanel" aria-labelled-by="tabs-04-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk 1/1 Running 0 9m19s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-agent-249rd 1/1 Running 0 9m19s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>svclb-nginx-vtnzg 1/1 Running 0 5m57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx-7b95fb6b6b-7sb9x 1/1 Running 0 5m57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx-7b95fb6b6b-lnzsq 1/1 Running 0 5m57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx-7b95fb6b6b-hlx27 1/1 Running 0 5m57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx-7b95fb6b6b-zwns9 1/1 Running 0 5m57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>svclb-nginx-loadgenerator-nscx4 1/1 Running 0 2m20s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx-loadgenerator-755c8f7ff6-x957q 1/1 Running 0 2m20s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 id="3-locust-の負荷テストの実行">3. Locust の負荷テストの実行&lt;/h2>
&lt;p>Locust はオープンソースの負荷テストツールで、EC2 インスタンスの IP アドレスの8080番ポートで Locust が利用できるようになりました。Webブラウザで新しいタブを開き、&lt;code>http://{==EC2-IP==}:8080/&lt;/code>にアクセスすると、Locust が動作しているのが確認できます。&lt;/p>
&lt;p>&lt;img src="../../../images/nginx-locust.png" alt="Locust">&lt;/p>
&lt;p>&lt;strong>Spawn rate&lt;/strong> を 2 に設定し、&lt;strong>Start Swarming&lt;/strong> をクリックします。&lt;/p>
&lt;p>&lt;img src="../../../images/nginx-locust-spawn-rate.png" alt="Locust Spawn Rate">&lt;/p>
&lt;p>これにより、アプリケーションに緩やかな連続した負荷がかかるようになります。&lt;/p>
&lt;p>&lt;img src="../../../images/nginx-locust-statistics.png" alt="Locust Statistics">&lt;/p>
&lt;p>上記のスクリーンショットからわかるように、ほとんどのコールは失敗を報告しています。これはアプリケーションをまだデプロイしていないため予想されることですが、NGINXはアクセス試行を報告しており、これらのメトリックも見ることができます。&lt;/p>
&lt;p>サイドメニューから &lt;strong>Dashboards → Built-in Dashboard Groups → NGINX → NGINX Servers&lt;/strong> を選択して、UIにメトリクスが表示されていることを確認します。さらに &lt;strong>Overrides&lt;/strong> フィルターを適用して、 &lt;code>k8s.cluster.name:&lt;/code> に、ターミナルの &lt;code>echo $(hostname)-k3s-cluster&lt;/code> で返されるクラスタの名前を見つけます。&lt;/p>
&lt;p>&lt;img src="../../../images/nginx-dashboard.png" alt="NGINXダッシュボード">&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>ConfigMap とは、キーと値のペアで非機密データを保存するために使用される API オブジェクトです。Pod は、環境変数、コマンドライン引数、またはボリューム内の構成ファイルとして ConfigMap を利用することができます。ConfigMap を使用すると、環境固有の構成をコンテナイメージから切り離すことができるため、アプリケーションの移植が容易になります。&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>&lt;a href="https://locust.io/" target="_blank">Locust とは？&lt;/a>
.&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item></channel></rss>