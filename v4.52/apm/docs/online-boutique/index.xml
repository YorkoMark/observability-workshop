<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Splunk Observability Cloud Workshops â€“ Online Boutique K8s Workshop</title><link>https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/</link><description>Recent content in Online Boutique K8s Workshop on Splunk Observability Cloud Workshops</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/index.xml" rel="self" type="application/rss+xml"/><item><title>Apm: Deploying the Online Boutique in K3s</title><link>https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/deploy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/deploy/</guid><description>
&lt;ul>
&lt;li>Deploy the Online Boutique application into Kubernetes (K3s)&lt;/li>
&lt;li>Verify the application is running&lt;/li>
&lt;li>Generate some artificial traffic using Locust&lt;/li>
&lt;li>See APM metrics in the UI&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="1-check-your-ec2-server">1. Check your EC2 server&lt;/h2>
&lt;p>This assumes you are running this after you have run the IM workshop, and still have access to your ec2 instance.
If this is the case, continue with paragraph 3. &lt;em>Deploy Online Boutique&lt;/em>,
otherwise if you have received a fresh instance, please run the first two (2) sections of &lt;a href="../../../../imt/docs/gdi/k3s">Deploying the OpenTelemetry Collector in Kubernetes&lt;/a>
to get the system ready for the APM workshop, then continue with the next section.&lt;/p>
&lt;h2 id="2-deploy-online-boutique">2. Deploy Online Boutique&lt;/h2>
&lt;p>To deploy the Online Boutique application into K3s, run the apm-config script, then apply the deployment:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-00-00-tab" data-toggle="tab" href="#tabs-00-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-00-00" aria-selected="false">
Deploy Online Boutique
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-00-01-tab" data-toggle="tab" href="#tabs-00-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-00-01" aria-selected="false">
Deployment Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-0-content">
&lt;div class="tab-pane fade show active"
id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">cd&lt;/span> ~/workshop/apm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./apm-config.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f deployment.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>APM Only Deployment
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/recommendationservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/recommendationservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/productcatalogservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/productcatalogservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/cartservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/cartservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/adservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/adservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/paymentservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/paymentservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/loadgenerator created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/loadgenerator created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/shippingservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/shippingservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/currencyservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/currencyservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/redis-cart created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/redis-cart created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/checkoutservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/checkoutservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/frontend created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/frontend created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/frontend-external created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/emailservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service/emailservice created
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/rum-loadgen-deployment created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="alert alert-warning" role="alert">
&lt;p class="alert-heading">In case of a message about a VARIABLE being unset&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
Please undeploy the APM environment first by running &lt;strong>kubectl delete -f deployment.yaml&lt;/strong>&lt;/br>
Then export the variable as described in the guide/message, followed by rerunning the deployment script above.
&lt;/p>
&lt;/div>
&lt;/div>
&lt;p>To ensure the Online Boutique application is running:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-2" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-02-00-tab" data-toggle="tab" href="#tabs-02-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-02-00" aria-selected="false">
Get Pods
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-02-01-tab" data-toggle="tab" href="#tabs-02-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-02-01" aria-selected="false">
Get Pods Output
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-2-content">
&lt;div class="tab-pane fade show active"
id="tabs-02-00" role="tabpanel" aria-labelled-by="tabs-02-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl get pods&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-02-01" role="tabpanel" aria-labelled-by="tabs-02-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-k8s-cluster-receiver-849cf595bf-l7mnq 1/1 Running 0 31m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>splunk-otel-collector-agent-pxrgp 2/2 Running 0 31m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>productcatalogservice-8464cd56d-n8f89 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>redis-cart-bcf44df97-djv6z 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>checkoutservice-8558fd7b95-b9pn8 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>shippingservice-7cc4bdd6f4-xsvnx 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>recommendationservice-647d57fd44-l7tkq 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>frontend-66c5d589d-55vzb 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>emailservice-6ff5bbd67d-pdcm2 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>paymentservice-6866558995-8xmf2 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>currencyservice-8668d75d6f-mr68h 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rum-loadgen-deployment-58ccf7bd8f-cr4pr 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rum-loadgen-deployment-58ccf7bd8f-qjr4b 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rum-loadgen-deployment-58ccf7bd8f-fvb4x 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cartservice-7b58c88c45-xvxhq 1/1 Running 0 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>loadgenerator-6bdc7b4857-9kxjd 1/1 Running 2 (49s ago) 1m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>adservice-7b68d5b969-89ft2 1/1 Running 0 1m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="alert alert-info" role="alert">
&lt;p class="alert-heading">Info&lt;/p>
&lt;div class="alert-body">
&lt;p class="p-alert-body">
Usually it should only take around 1min 30secs for the pods to transition into a Running state.
&lt;/p>
&lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 id="4-validate-in-the-ui">4. Validate in the UI&lt;/h2>
&lt;p>In the Splunk UI click on Infrastructure &lt;img src="../../../images/infrastructure.png" alt="infrastructure button"> this will bring you to the Infrastructure Overview dashboard, then click on &lt;strong>Kubernetes&lt;/strong>.&lt;/p>
&lt;p>Use the &lt;strong>Cluster&lt;/strong> dropdown so select your cluster, you should see the new pods started and containers deployed.&lt;/p>
&lt;p>When you click on your cluster in the Splunk UI you should have a view that looks like below:&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-k8s.png" alt="back to Cluster">&lt;/p>
&lt;p>If you select the &lt;strong>WORKLOADS&lt;/strong> tab again you should now see that there are a number of Deployments and ReplicaSets:&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-workload.png" alt="HOTROD loaded">&lt;/p>
&lt;hr>
&lt;h2 id="5-view-online-boutique">5. View Online Boutique&lt;/h2>
&lt;p>The Online Boutique is viewable on port 81 of the EC2 instance&amp;rsquo;s IP address. The IP address is the one you used to SSH into the instance at the beginning of the workshop.&lt;/p>
&lt;p>Open your web browser and go to &lt;code>http://{==EC2-IP==}:81/&lt;/code> where you will then be able to see the Online Boutique running.&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique.png" alt="Online Boutique">&lt;/p></description></item><item><title>Apm: Generate traffic using Locust</title><link>https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/locust/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://splunk.github.io/observability-workshop/v4.52/apm/docs/online-boutique/locust/</guid><description>
&lt;h2 id="1-generate-traffic">1. Generate traffic&lt;/h2>
&lt;p>The Online Boutique deployment contains a container running Locust that we can use to generate load traffic against the website to generate metrics, traces and spans.&lt;/p>
&lt;p>Locust is available on port 82 of the EC2 instance&amp;rsquo;s IP address. Open a new tab in your web browser and go to &lt;code>http://{==EC2-IP==}:82/&lt;/code>, you will then be able to see the Locust running.&lt;/p>
&lt;p>&lt;img src="../../../images/locust.png" alt="Locust">&lt;/p>
&lt;p>Set the &lt;strong>Spawn rate&lt;/strong> to be 2 and click &lt;strong>Start Swarming&lt;/strong>, this will start a gentle continous load on the application.&lt;/p>
&lt;p>&lt;img src="../../../images/locust-spawn-rate.png" alt="Spawn Rate">&lt;/p>
&lt;p>&lt;img src="../../../images/locust-statistics.png" alt="Statistics">&lt;/p>
&lt;hr>
&lt;p>Now go to &lt;strong>&lt;img src="../../../images/dashboards.png" alt="dashboards button"> Dashboards â†’ All Dashboards â†’ APM Services â†’ Service&lt;/strong>.&lt;/p>
&lt;p>For this we need to know the name of your application environment. In this workshop all the environments use: &lt;code>{==hostname==}-apm-env&lt;/code>.&lt;/p>
&lt;p>To find the hostname, on the AWS/EC2 instance run the following command:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-0" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-sh"
id="tabs-00-00-tab" data-toggle="tab" href="#tabs-00-00" role="tab"
onclick="persistLang(&amp;#34;sh&amp;#34;);"aria-controls="tabs-00-00" aria-selected="false">
Echo Hostname
&lt;/a>
&lt;/li>&lt;li class="nav-item">
&lt;a class="nav-link persistLang-text"
id="tabs-00-01-tab" data-toggle="tab" href="#tabs-00-01" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-00-01" aria-selected="false">
Output Example
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-0-content">
&lt;div class="tab-pane fade show active"
id="tabs-00-00" role="tabpanel" aria-labelled-by="tabs-00-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>hostname&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>-apm-env&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;div class="tab-pane fade"
id="tabs-00-01" role="tabpanel" aria-labelled-by="tabs-00-01-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>bdzx-apm-env&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>Select your environment you found in the previous step then select the &lt;code>frontend&lt;/code> service and set time to Past 15 minutes.&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-service-dashboard.png" alt="APM Dashboard">&lt;/p>
&lt;p>With this automatically generated dashboard you can keep an eye out for the health of your service(s) using RED (Rate, Error &amp;amp; Duration) metrics. It provides various performance related charts as well as correlated information on the underlying host and Kubernetes pods (if applicable).&lt;/p>
&lt;p>Take some time to explore the various charts in this dashboard&lt;/p>
&lt;hr>
&lt;h2 id="2-verify-splunk-apm-metrics">2. Verify Splunk APM metrics&lt;/h2>
&lt;p>In the left hand menu card click on APM &lt;img src="../../../images/apm.png" alt="apm button"> this will bring you to the APM Overview dashboard:&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-apm.png" alt="select APM">&lt;/p>
&lt;p>Select the &lt;strong>Explore&lt;/strong> on the right hand side and select your environment you found before and set the time to 15 minutes. This will show you the automatically generated Dependency/Service Map for the Online Boutique application.&lt;/p>
&lt;p>It should look similar to the screenshot below:&lt;/p>
&lt;p>&lt;img src="../../../images/online-boutique-map.png" alt="Online Boutique in APM">&lt;/p>
&lt;p>The legend at the bottom of the page explains the different visualizations in the Dependency/Service Map.&lt;/p>
&lt;p>&lt;img src="../../../images/apm-legend.png" alt="APM Legend">&lt;/p>
&lt;ul>
&lt;li>Service requests, error rate and root error rate.&lt;/li>
&lt;li>Request rate, latency and error rate&lt;/li>
&lt;/ul>
&lt;p>Also in this view you can see the overall Error and Latency rates over time charts.&lt;/p>
&lt;h2 id="3-opentelemetry-dashboard">3. OpenTelemetry Dashboard&lt;/h2>
&lt;p>Once the Open Telemetery Collector is deployed the platform will automatically provide a built in dashboard display OpenTelemetry Collector metrics.&lt;/p>
&lt;p>From the top left hamburger menu, select &lt;img src="../../../images/dashboards.png" alt="dashboards button"> &lt;strong>Dashboards â†’ OpenTelemetry Collector&lt;/strong>, scroll all the way to the bottom of the page and validate metrics and spans are being sent:&lt;/p>
&lt;p>&lt;img src="../../../images/otel-dashboard.png" alt="OpenTelemetry Collector dashboard">&lt;/p>
&lt;h2 id="4-opentelemetry-zpages">4. OpenTelemetry zpages&lt;/h2>
&lt;p>To debug the traces being sent you can use the zpages extension. &lt;a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/experimental/trace/zpages.md#tracez" target="_blank">zpages&lt;/a>
are part of the OpenTelemetry collector and provide live data for troubleshooting and statistics. They are available on port &lt;code>55679&lt;/code> of the EC2 instance&amp;rsquo;s IP address. Open a new tab in your web browser and enter in &lt;code>http://{==EC2-IP==}:55679/debug/tracez&lt;/code>, you will then be able to see the zpages output.&lt;/p>
&lt;p>&lt;img src="../../../images/zpages.png" alt="zpages">&lt;/p>
&lt;p>Alternatively, from your shell prompt you can run a text based browser:&lt;/p>
&lt;ul class="nav nav-tabs" id="tabs-1" role="tablist">
&lt;li class="nav-item">
&lt;a class="nav-link active persistLang-text"
id="tabs-01-00-tab" data-toggle="tab" href="#tabs-01-00" role="tab"
onclick="persistLang(&amp;#34;text&amp;#34;);"aria-controls="tabs-01-00" aria-selected="false">
Lynx Command
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;div class="tab-content" id="tabs-1-content">
&lt;div class="tab-pane fade show active"
id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab">
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>lynx http://localhost:55679/debug/tracez&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;/div></description></item></channel></rss>