<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.11.2+tip"><meta name=description content="Splunk Observability Workshops"><title>Getting Data In (GDI) & OTEL :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/index.html rel=canonical type=text/html title="Getting Data In (GDI) & OTEL :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/index.xml rel=alternate type=application/rss+xml title="Getting Data In (GDI) & OTEL :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.56/images/favicon.ico?1676474828 rel=icon type=image/x-icon><link href=https://splunk.github.io/observability-workshop/v4.56/css/fontawesome-all.min.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/fontawesome-all.min.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/auto-complete.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/auto-complete.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/perfect-scrollbar.min.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/nucleus.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/fonts.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/fonts.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/theme.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/theme-splunk-light.css?1676474829 rel=stylesheet id=variant-style><link href=https://splunk.github.io/observability-workshop/v4.56/css/ie.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/variant.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/print.css?1676474829 rel=stylesheet media=print><link href=https://splunk.github.io/observability-workshop/v4.56/css/format-print.css?1676474829 rel=stylesheet><script src=https://splunk.github.io/observability-workshop/v4.56/js/url.js?1676474829></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/variant.js?1676474829></script>
<script>window.index_js_url="https://splunk.github.io/observability-workshop/v4.56/index.search.js";var root_url="https://splunk.github.io/observability-workshop/v4.56/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.56/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable dir=ltr><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.56/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.56/tko/index.html><span itemprop=name>TKO Workshops</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Getting Data In (GDI) & OTEL</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=chapter><div class=article-subheading>Chapter 2</div><h1 id=getting-data-in-gdi--otel>Getting Data In (GDI) & OTEL</h1><h2 id=introduction>Introduction</h2><p>During this technical workshop you will learn how to:</p><ul><li>efficiently deploy complex environments</li><li>capture metrics from these environments to Splunk Observability Cloud</li><li>auto-instrument a python application</li><li>enabling OS logging to Splunk Enterprise via Universal Forwarder</li></ul><p>In order to simplify the workshop modules, a pre-configured AWS EC2 instance is provided.</p><p>By the end of this technical workshop you will have an approach to demonstrating metrics collection for complex environments and services and be able to describe, at a high-level, what is required to instrument an application for distributed tracing.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Getting Data In (GDI) & OTEL</h1><article class=default><h1 id=getting-started-with-o11y-gdi---real-time-enrichment-workshop>Getting Started with O11y GDI - Real Time Enrichment Workshop</h1><p>Please note to begin the following lab, you must have completed the prework:</p><ul><li>Obtain a Splunk Observability Cloud access key</li><li>Understand cli commands</li></ul><p>Follow these steps if using O11y Workshop EC2 instances</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># note: verify yelp data files are present</span>
</span></span><span style=display:flex><span>ll /var/appdata/yelp*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SPLUNK_ACCESS_TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-access-token&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SPLUNK_REALM</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-o11y-cloud-realm&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ACCESS_TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-access-token&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>REALM</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-o11y-cloud-realm&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>clusterName</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-k8s-cluster&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> /home/ubuntu
</span></span><span style=display:flex><span>git clone https://github.com/leungsteve/realtime_enrichment.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> realtime_enrichment/workshop
</span></span><span style=display:flex><span>python3 -m venv rtapp-workshop
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> rtapp-workshop/bin/activate
</span></span></code></pre></div><footer class=footline></footer></article><article class=default><h1 id=deploy-complex-environments-and-capture-meterics>Deploy complex environments and capture meterics</h1><p><strong>Objective:</strong> Learn how to efficiently deploy complex infrastructure components such as Kafka and MongoDB to demonstrate metrics collection with Splunk O11y IM integrations</p><p><strong>Duration</strong>: 15 Minutes</p><h2 id=scenario>Scenario</h2><p>A prospect uses Kafka and MongoDB in their environment. Since there are integrations for these services, you’d like to demonstrate this to the prospect. What is a quick and efficient way to set up a live environment with these services and have metrics collected?</p><h3 id=1-where-can-i-find-helm-charts>1. Where can I find helm charts?</h3><ul><li>Google “myservice helm chart”</li><li><code>https://artifacthub.io/</code> (<strong>Note:</strong> Look for charts from trusted organizations, with high star count and frequent updates)</li></ul><h3 id=2-review-apache-kafka-packaged-by-bitnamihttpsgithubcombitnamichartstreemainbitnamikafkainstalling-the-chart>2. Review <a href=https://github.com/bitnami/charts/tree/main/bitnami/kafka/#installing-the-chart target=_blank>Apache Kafka packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>replicaCount=3</code></li><li><code>metrics.jmx.enabled=true</code></li><li><code>metrics.kafka.enabled=true</code></li><li><code>deleteTopicEnable=true</code></li></ul><h3 id=3-review-mongodbr-packaged-by-bitnamihttpsgithubcombitnamichartstreemasterbitnamimongodbinstalling-the-chart>3. Review <a href=https://github.com/bitnami/charts/tree/master/bitnami/mongodb/#installing-the-chart target=_blank>MongoDB(R) packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>version 12.1.31</code></li><li><code>metrics.enabled=true</code></li><li><code>global.namespaceOverride=default</code></li><li><code>auth.rootUser=root</code></li><li><code>auth.rootPassword=splunk</code></li><li><code>auth.enabled=false</code></li></ul><h3 id=4-install-kafka-and-mongodb-with-helm-charts>4. Install Kafka and MongoDB with helm charts</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install kafka --set <span style=color:#000>replicaCount</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span> --set metrics.jmx.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> --set metrics.kafka.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>  --set <span style=color:#000>deleteTopicEnable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> bitnami/kafka
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install mongodb --set metrics.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> bitnami/mongodb --set global.namespaceOverride<span style=color:#ce5c00;font-weight:700>=</span>default --set auth.rootUser<span style=color:#ce5c00;font-weight:700>=</span>root --set auth.rootPassword<span style=color:#ce5c00;font-weight:700>=</span>splunk --set auth.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> --version 12.1.31
</span></span></code></pre></div><p>###verify the helm chart installation
helm list
NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION
kafka default 1 2022-11-14 11:21:36.328956822 -0800 PST deployed kafka-19.1.3 3.3.1
mongodb default 1 2022-11-14 11:19:36.507690487 -0800 PST deployed mongodb-12.1.31 5.0.10</p><p>###verify the helm chart installation</p><p>kubectl get pods
NAME READY STATUS RESTARTS AGE
kafka-exporter-595778d7b4-99ztt 0/1 ContainerCreating 0 17s
mongodb-b7c968dbd-jxvsj 0/2 Pending 0 6s
kafka-1 0/2 ContainerCreating 0 16s
kafka-2 0/2 ContainerCreating 0 16s
kafka-zookeeper-0 0/1 Pending 0 17s
kafka-0 0/2 Pending 0 17s</p><pre tabindex=0><code>
Use information for each Helm chart and Splunk O11y Data Setup to generate values.yaml for capturing metrics from Kafka and MongoDB.


<div class="box notices cstyle default" style=--VARIABLE-BOX-color:info>
  <div class=box-label>Note</div>
  <div class=box-content>
<p><code>values.yaml</code> for the different services will be passed to the Splunk Helm Chart at installation time. These will configure the OTEL collector to capture metrics from these services.</p>
  </div>
</div>

- References:
  - [Apache Kafka packaged by Bitnami](https://github.com/bitnami/charts/tree/master/bitnami/spark/#installing-the-chart)
  - [Configure application receivers for databases » Apache Kafka](https://docs.splunk.com/Observability/gdi/kafka/kafka.html)
  - [Kafkametricsreceiver](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkametricsreceiver)

#### 4.1 Example kafka.values.yaml

``` yaml
otelAgent:
config:
    receivers:
    receiver_creator:
        receivers:
        smartagent/kafka:
            rule: type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka&#34;
            config:
                    #endpoint: &#39;`endpoint`:5555&#39;
            port: 5555
            type: collectd/kafka
            clusterName: sl-kafka
otelK8sClusterReceiver:
k8sEventsEnabled: true
config:
    receivers:
    kafkametrics:
        brokers: kafka:9092
        protocol_version: 2.0.0
        scrapers:
        - brokers
        - topics
        - consumers
    service:
    pipelines:
        metrics:
        receivers:
                #- prometheus
        - k8s_cluster
        - kafkametrics
</code></pre><h4 id=42-example-mongodbvaluesyaml>4.2 Example mongodb.values.yaml</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>otelAgent</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>receivers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>receiver_creator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>receivers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>smartagent/mongodb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>rule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>type == &#34;pod&#34; &amp;&amp; name matches &#34;mongo&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>collectd/mongodb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mongodb.default.svc.cluster.local</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>27017</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>databases</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;O11y&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;local&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;config&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>sendCollectionMetrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>sendCollectionTopMetrics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=43-example-zookeepervaluesyaml>4.3 Example zookeeper.values.yaml</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>otelAgent</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>receivers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>receiver_creator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>receivers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>smartagent/zookeeper</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>rule</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka-zookeeper&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>collectd/zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kafka-zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2181</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=5-install-the-splunk-otel-helm-chart>5. Install the Splunk OTEL helm chart</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ../otel_yamls
</span></span><span style=display:flex><span>repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart
</span></span><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>helm install --set <span style=color:#000>provider</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39; &#39;</span> --set <span style=color:#000>distro</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39; &#39;</span> --set splunkObservability.accessToken<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SPLUNK_ACCESS_TOKEN</span> --set <span style=color:#000>clusterName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$clusterName</span> --set splunkObservability.realm<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SPLUNK_REALM</span> --set otelCollector.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;false&#39;</span> --set splunkObservability.logsEnabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;true&#39;</span> --set gateway.enabled<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;false&#39;</span> --values kafka.values.yaml --values mongodb.values.yaml --values zookeeper.values.yaml --values alwayson.values.yaml --values k3slogs.yaml --generate-name splunk-otel-collector-chart/splunk-otel-collector
</span></span></code></pre></div><h3 id=6-verify-installation>6. Verify installation</h3><p>Verify that the Kafka, MongoDB and Splunk OTEL Collector helm charts are installed, note that names may differ.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$helm list
</span></span><span style=display:flex><span>NAME                                NAMESPACE   REVISION    UPDATED                                 STATUS      CHART                           APP VERSION
</span></span><span style=display:flex><span>kafka                               default     1           2021-12-07 12:48:47.066421971 -0800 PST deployed    kafka-14.4.1                    2.8.1
</span></span><span style=display:flex><span>mongodb                             default     1           2021-12-07 12:49:06.132771625 -0800 PST deployed    mongodb-10.29.2                 4.4.10
</span></span><span style=display:flex><span>splunk-otel-collector-1638910184    default     1           2021-12-07 12:49:45.694013749 -0800 PST deployed    splunk-otel-collector-0.37.1    0.37.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get pods
</span></span><span style=display:flex><span>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>kafka-zookeeper-0                                                 1/1     Running   0          18m
</span></span><span style=display:flex><span>kafka-2                                                           2/2     Running   1          18m
</span></span><span style=display:flex><span>mongodb-79cf87987f-gsms8                                          2/2     Running   0          18m
</span></span><span style=display:flex><span>kafka-1                                                           2/2     Running   1          18m
</span></span><span style=display:flex><span>kafka-exporter-7c65fcd646-dvmtv                                   1/1     Running   3          18m
</span></span><span style=display:flex><span>kafka-0                                                           2/2     Running   1          18m
</span></span><span style=display:flex><span>splunk-otel-collector-1638910184-agent-27s5c                      2/2     Running   0          17m
</span></span><span style=display:flex><span>splunk-otel-collector-1638910184-k8s-cluster-receiver-8587qmh9l   1/1     Running   0          17m
</span></span></code></pre></div><h3 id=7-verify-dashboards>7. Verify dashboards</h3><p>Verify that out of the box dashboards for Kafka, MongoDB and Zookeeper are populated in the Infrastructure Monitor landing page. Drill down into each component to view granular details for each service.</p><ul><li>Infrastructure Monitoring Landing page:</li></ul><p><a href=#image-45fec1942946f545b1fbce59f17ede7c class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/inframon.jpg alt=IM-landing-page style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-45fec1942946f545b1fbce59f17ede7c><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/inframon.jpg alt=IM-landing-page class=lightbox-image loading=lazy></a></p><ul><li>K8 Navigator:</li></ul><p><a href=#image-1890f0787a52858d8c1637cc3cf7575a class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/k8navigator.jpg alt=k8-navigator style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1890f0787a52858d8c1637cc3cf7575a><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/k8navigator.jpg alt=k8-navigator class=lightbox-image loading=lazy></a></p><ul><li>MongoDB Dashboard:</li></ul><p><a href=#image-ee09b92a160d77f6ed0ada262fc3f6c9 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/mongoDB.jpg alt=mongodb-dash style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ee09b92a160d77f6ed0ada262fc3f6c9><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/mongoDB.jpg alt=mongodb-dash class=lightbox-image loading=lazy></a></p><ul><li>Kafka Dashboard:</li></ul><p><a href=#image-96c0ed9db5a349655e2c33934ca17938 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/kafka.jpg alt=kafka-dash style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-96c0ed9db5a349655e2c33934ca17938><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/deploy/../images/kafka.jpg alt=kafka-dash class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><h1 id=code-to-kubernetes---python>Code to Kubernetes - Python</h1><h2 id=code-to-kubernetes---python>Code to Kubernetes - Python</h2><p><strong>Objective:</strong> Understand activities to instrument a python application and run it on Kubernetes.</p><ul><li>Verify the code</li><li>Containerize the app</li><li>Deploy the container in Kubernetes</li></ul><p><strong>Note:</strong> these steps do not involve Splunk</p><p><strong>Duration:</strong> 15 Minutes</p><h2 id=1-verify-the-code---review-service>1. Verify the code - Review service</h2><p>Inspect review.py (workshop/flask_apps_start/review)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>flask</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Flask</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>jsonify</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>random</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>subprocess</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>review</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Flask</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>__name__</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>num_reviews</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>8635403</span>
</span></span><span style=display:flex><span><span style=color:#000>num_reviews</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>100000</span>
</span></span><span style=display:flex><span><span style=color:#000>reviews_file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/var/appdata/yelp_academic_dataset_review.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@review.route</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>hello_world</span><span style=color:#000;font-weight:700>():</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>jsonify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Hello, you want to hit /get_review. We have &#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#204a87>str</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>num_reviews</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39; reviews!&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@review.route</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/get_review&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>get_review</span><span style=color:#000;font-weight:700>():</span>
</span></span><span style=display:flex><span>    <span style=color:#000>random_review_int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>str</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>random</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>randint</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>num_reviews</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>    <span style=color:#000>line_num</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>random_review_int</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;q;d&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;sed&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>line_num</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reviews_file</span><span style=color:#000;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic># sed &#34;7997242q;d&#34; &lt;file&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>random_review</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>subprocess</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>command</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>subprocess</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PIPE</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>random_review</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>stdout</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>review</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>host</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;0.0.0.0&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>port</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5000</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>debug</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Inspect requirements.txt</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Flask==2.0.2
</span></span></code></pre></div><p>Create a virtual environment and Install the necessary python packages</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> workshop/flask_apps_start/review
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python3 -m venv rtapp-workshop
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> rtapp-workshop/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pip freeze <span style=color:#8f5902;font-style:italic>#note output</span>
</span></span><span style=display:flex><span>pip install -r requirements.txt
</span></span><span style=display:flex><span>pip freeze <span style=color:#8f5902;font-style:italic>#note output</span>
</span></span></code></pre></div><p>Start the REVIEW service. <strong>Note:</strong> You can stop the app with control+C</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 review.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Serving Flask app <span style=color:#4e9a06>&#39;review&#39;</span> <span style=color:#ce5c00;font-weight:700>(</span>lazy loading<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span> * Environment: production
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span> * Running on http://10.160.145.246:5000/ <span style=color:#ce5c00;font-weight:700>(</span>Press CTRL+C to quit<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span> * Restarting with stat
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#ce5c00;font-weight:700>[</span>17/May/2022 22:46:38<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#4e9a06>&#34;GET / HTTP/1.1&#34;</span> <span style=color:#0000cf;font-weight:700>200</span> -
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#ce5c00;font-weight:700>[</span>17/May/2022 22:47:02<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#4e9a06>&#34;GET /get_review HTTP/1.1&#34;</span> <span style=color:#0000cf;font-weight:700>200</span> -
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#ce5c00;font-weight:700>[</span>17/May/2022 22:47:58<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#4e9a06>&#34;GET /get_review HTTP/1.1&#34;</span> <span style=color:#0000cf;font-weight:700>200</span> -
</span></span></code></pre></div><p>Verify that the service is working</p><ul><li>Use curl in your terminal</li><li>Or hit the URL <code>http://{Your_EC2_IP_address}:5000</code> and <code>http://{Your_EC2_IP_address}:5000/get_review</code> with a browser</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl localhost:5000
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl localhost:5000/get_review
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;review_id&#34;</span>:<span style=color:#4e9a06>&#34;NjbiESXotcEdsyTc4EM3fg&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:<span style=color:#4e9a06>&#34;PR9LAM19rCM_HQiEm5OP5w&#34;</span>,<span style=color:#4e9a06>&#34;business_id&#34;</span>:<span style=color:#4e9a06>&#34;UAtX7xmIfdd1W2Pebf6NWg&#34;</span>,<span style=color:#4e9a06>&#34;stars&#34;</span>:3.0,<span style=color:#4e9a06>&#34;useful&#34;</span>:0,<span style=color:#4e9a06>&#34;funny&#34;</span>:0,<span style=color:#4e9a06>&#34;cool&#34;</span>:0,<span style=color:#4e9a06>&#34;text&#34;</span>:<span style=color:#4e9a06>&#34;-If you&#39;re into cheap beer (pitcher of bud-light for </span><span style=color:#000>$7</span><span style=color:#4e9a06>) decent wings and a good time, this is the place for you. Its generally very packed after work hours and weekends. Don&#39;t expect cocktails. \n\n-You run into a lot of sketchy characters here sometimes but for the most part if you&#39;re chilling with friends its not that bad. \n\n-Friendly bouncer and bartenders.&#34;</span>,<span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2016-04-12 20:23:24&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>What does this application do?</li><li>Do you see the yelp dataset being used?</li><li>Why did the output of pip freeze differ each time you ran it?</li><li>Which port is the REVIEW app listening on? Can other python apps use this same port?</li></ul></div></div>}</p><h2 id=2-create-a-review-container>2. Create a REVIEW container</h2><p>To create a container image, you need to create a Dockerfile, run docker build to build the image referencing the Docker file and push it up to a remote repository so it can be pulled by other sources.</p><ul><li><a href=https://docs.docker.com/get-started/02_our_app/ target=_blank>Create a Dockerfile</a></li><li>Creating a Dockerfile typically requires you to consider the following:<ul><li>Identify an appropriate container image<ul><li>ubuntu vs. python vs. alpine/slim</li><li>ubuntu - overkill, large image size, wasted resources when running in K8</li><li>this is a python app, so pick an image that is optimized for it</li><li><a href=https://lih-verma.medium.com/alpine-makes-python-docker-builds-way-too-50-slower-and-images-double-2-larger-61d1d43cbc79 target=_blank>avoid alpine for python</a></li></ul></li><li>Order matters<ul><li>you&rsquo;re building layers.</li><li>re-use the layers as much as possible</li><li>have items that change often towards the end</li></ul></li><li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ target=_blank>Other Best practices for writing Dockerfiles</a></li></ul></li></ul><p>Dockerfile for review</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> python:3.10-slim</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>WORKDIR</span><span style=color:#4e9a06> /app</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>COPY</span> requirements.txt /app<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> pip install -r requirements.txt<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>COPY</span> ./review.py /app<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>EXPOSE</span><span style=color:#4e9a06> 5000</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>CMD</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#4e9a06>&#34;python&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;review.py&#34;</span> <span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Create a container image (locally)
Run ‘docker build’ to build a local container image referencing the Dockerfile</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span>venv<span style=color:#ce5c00;font-weight:700>)</span>% docker build -f Dockerfile -t localhost:8000/review:0.01 .
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>+<span style=color:#ce5c00;font-weight:700>]</span> Building 35.5s <span style=color:#ce5c00;font-weight:700>(</span>11/11<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>FINISHED</span>
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>[</span>internal<span style=color:#ce5c00;font-weight:700>]</span> load build definition from Dockerfile                              0.0s
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>[</span>3/5<span style=color:#ce5c00;font-weight:700>]</span> COPY requirements.txt /app                                              0.0s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>[</span>4/5<span style=color:#ce5c00;font-weight:700>]</span> RUN pip install -r requirements.txt                                     4.6s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>[</span>5/5<span style=color:#ce5c00;font-weight:700>]</span> COPY ./review.py /app                                                   0.0s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; exporting to image                                                            0.2s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>=</span>&gt; exporting layers                                                           0.2s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>=</span>&gt; writing image sha256:61da27081372723363d0425e0ceb34bbad6e483e698c6fe439c5  0.0s
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>=</span>&gt; <span style=color:#ce5c00;font-weight:700>=</span>&gt; naming to docker.io/localhost:8000/review:0.1                                   0.0
</span></span></code></pre></div><p>Push the container image into a container repository
Run ‘docker push’ to place a copy of the REVIEW container to a remote location</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker push localhost:8000/review:0.01
</span></span><span style=display:flex><span>The push refers to repository <span style=color:#ce5c00;font-weight:700>[</span>docker.io/localhost:8000/review<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>02c36dfb4867: Pushed
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span>fd95118eade9: Pushed
</span></span><span style=display:flex><span>0.1: digest: sha256:3651f740abe5635af95d07acd6bcf814e4d025fcc1d9e4af9dee023a9b286f38 size: <span style=color:#0000cf;font-weight:700>2202</span>
</span></span></code></pre></div><p>Verify that the image is in Docker Hub. The same info can be found in Docker Desktop</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s http://localhost:8000/v2/_catalog
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;repositories&#34;</span>:<span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;review&#34;</span><span style=color:#ce5c00;font-weight:700>]}</span>
</span></span></code></pre></div><h2 id=3-run-review-in-kubernetes>3. Run REVIEW in Kubernetes</h2><p>Create K8 deployment yaml file for the REVIEW app</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment target=_blank>Creating a Deployment</a></p><p>review.deployment.yaml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>imagePullSecrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>regcred</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8000/review:0.01</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hostPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Notes regarding review.deployment.yaml:</p><ul><li>labels - K8 uses labels and selectors to tag and identify resources<ul><li>In the next step, we&rsquo;ll create a service and associate it to this deployment using the label</li></ul></li><li>replicas = 1<ul><li>K8 allows you to scale your deployments horizontally</li><li>We&rsquo;ll leverage this later to add load and increase our ingestion rate</li></ul></li><li>regcred provides this deployment with the ability to access your dockerhub credentials which is necessary to pull the container image.</li><li>The volume definition and volumemount make the yelp dataset visible to the container</li></ul><p>Create a K8 service yaml file for the review app.</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/services-networking/service/#defining-a-service target=_blank>Creating a service:</a></p><p>review.service.yaml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodePort</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>nodePort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Notes about review.service.yaml:</p><ul><li>the selector associates this service to pods with the label app with the value being review</li><li>the review service exposes the review pods as a network service<ul><li>other pods can now ping &lsquo;review&rsquo; and they will hit a review pod.</li><li>a pod would get a review if it ran <code>curl http://review:5000</code></li></ul></li><li>NodePort service<ul><li>the service is accessible to the K8 host by the nodePort, 30000</li><li>Another machine that has this can get a review if it ran <code>curl http://&lt;k8 host ip>:30000</code></li></ul></li></ul><p>Apply the review deployment and service</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f review.service.yaml -f review.deployment.yaml
</span></span></code></pre></div><p>Verify that the deployment and services are running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ kubectl get deployments
</span></span><span style=display:flex><span>NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>review                                                  1/1     1            1           19h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ kubectl get services
</span></span><span style=display:flex><span>NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
</span></span><span style=display:flex><span>review                     NodePort    10.43.175.21    &lt;none&gt;        5000:30000/TCP                  154d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ curl localhost:30000
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;message&#34;: &#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ curl localhost:30000/get_review
</span></span><span style=display:flex><span>{&#34;review_id&#34;:&#34;Vv9rHtfBrFc-1M1DHRKN9Q&#34;,&#34;user_id&#34;:&#34;EaNqIwKkM7p1bkraKotqrg&#34;,&#34;business_id&#34;:&#34;TA1KUSCu8GkWP9w0rmElxw&#34;,&#34;stars&#34;:3.0,&#34;useful&#34;:1,&#34;funny&#34;:0,&#34;cool&#34;:0,&#34;text&#34;:&#34;This is the first time I&#39;ve actually written a review for Flip, but I&#39;ve probably been here about 10 times.  \n\nThis used to be where I would take out of town guests who wanted a good, casual, and relatively inexpensive meal.  \n\nI hadn&#39;t been for a while, so after a long day in midtown, we decided to head to Flip.  \n\nWe had the fried pickles, onion rings, the gyro burger, their special burger, and split a nutella milkshake.  I have tasted all of the items we ordered previously (with the exception of the special) and have been blown away with how good they were.  My guy had the special which was definitely good, so no complaints there.  The onion rings and the fried pickles were greasier than expected.  Though I&#39;ve thought they were delicious in the past, I probably wouldn&#39;t order either again.  The gyro burger was good, but I could have used a little more sauce.  It almost tasted like all of the ingredients didn&#39;t entirely fit together.  Something was definitely off. It was a friday night and they weren&#39;t insanely busy, so I&#39;m not sure I would attribute it to the staff not being on their A game...\n\nDon&#39;t get me wrong.  Flip is still good.  The wait staff is still amazingly good looking.  They still make delicious milk shakes.  It&#39;s just not as amazing as it once was, which really is a little sad.&#34;,&#34;date&#34;:&#34;2010-10-11 18:18:35&#34;}
</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What changes are required if you need to make an update to your Dockerfile now?</p></div></div><footer class=footline></footer></article><article class=default><h1 id=instrument-reviews-for-tracing>Instrument REVIEWS for Tracing</h1><h2 id=1-use-data-setup-to-instrument-a-python-application>1. Use Data Setup to instrument a Python application</h2><p>Within the O11y Cloud UI:</p><p>Data Setup -> Monitor Applications -> Python (traces) -> Add Integration</p><p>Provide the following to the Configure Integration Wizard:</p><ul><li><p>Service: review</p></li><li><p>Django: no</p></li><li><p>collector endpoint: <code>http://localhost:4317</code></p></li><li><p>Environment: rtapp-workshop-[YOURNAME]</p></li><li><p>Kubernetes: yes</p></li><li><p>Legacy Agent: no</p></li></ul><p><a href=#image-d3b157c67ff577e7cd2d06c47159af17 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/instrument/../images/configureintegration.png alt=o11y_cloud_ui style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d3b157c67ff577e7cd2d06c47159af17><img src=https://splunk.github.io/observability-workshop/v4.56/tko/session-2/docs/instrument/../images/configureintegration.png alt=o11y_cloud_ui class=lightbox-image loading=lazy></a></p><p>We are instructed to:</p><ul><li><p>Install the instrumentation packages for your Python environment.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>pip install splunk-opentelemetry[all]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>splunk-py-trace-bootstrap
</span></span></code></pre></div></li><li><p>Configure the Downward API to expose environment variables to Kubernetes resources.</p><p>For example, update a Deployment to inject environment variables by adding <code>.spec.template.spec.containers.env</code> like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>your-application</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>myapp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SPLUNK_OTEL_AGENT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>valueFrom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>fieldRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>fieldPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>status.hostIP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_EXPORTER_OTLP_ENDPOINT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_SERVICE_NAME</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;review&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_RESOURCE_ATTRIBUTES</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;deployment.environment=rtapp-workshop-stevel&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Enable the Splunk OTel Python agent by editing your Python service command.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>splunk-py-trace python3 main.py --port=8000
</span></span></code></pre></div></li><li><p>The actions we must perform include:</p><ul><li>Update the Dockerfile to install the splunk-opentelemetry packages</li><li>Update the deployment.yaml for each service to include these environment variables which will be used by the pod and container.</li><li>Update our Dockerfile for REVIEW so that our program is bootstrapped with splunk-py-trace</li></ul></li></ul><div class="box notices cstyle default" style=--VARIABLE-BOX-color:info><div class=box-label>Note</div><div class=box-content><p>We will accomplish this by 1) generating a new requirements.txt file, 2) generating a new container image with an updated Dockerfile for REVIEW and then 3) update the review.deployment.yaml to capture all of these changes.</p></div></div><h2 id=2-update-the-review-container>2. Update the REVIEW container</h2><ul><li><p>Generate a new container image</p></li><li><p>Update the Dockerfile for REVIEW (<code>/workshop/flask_apps_finish/review</code>)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> python:3.10-slim</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>WORKDIR</span><span style=color:#4e9a06> /app</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>COPY</span> requirements.txt /app<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> pip install -r requirements.txt<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> pip install splunk-opentelemetry<span style=color:#ce5c00;font-weight:700>[</span>all<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> splk-py-trace-bootstrap<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>COPY</span> ./review.py /app<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>EXPOSE</span><span style=color:#4e9a06> 5000</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>ENTRYPOINT</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#4e9a06>&#34;splunk-py-trace&#34;</span> <span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>CMD</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#4e9a06>&#34;python&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;review.py&#34;</span> <span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span></code></pre></div></li></ul><div class="box notices cstyle default" style=--VARIABLE-BOX-color:info><div class=box-label>Note</div><div class=box-content><p>Note that the only lines, in bold, added to the Dockerfile</p></div></div><ul><li><p>Generate a new container image with docker build in the ‘finished’ directory</p></li><li><p>Notice that I have changed the repository name from <code>localhost:8000/review:0.01</code> to <code>localhost:8000/review-splkotel:0.01</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>pwd
</span></span><span style=display:flex><span>./workshop/flask_apps_finish/review
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker build -f Dockerfile.review -t localhost:8000/review-splkotel:0.01 .
</span></span><span style=display:flex><span>[+] Building 27.1s (12/12) FINISHED
</span></span><span style=display:flex><span>=&gt; [internal] load build definition from Dockerfile                                                        0.0s
</span></span><span style=display:flex><span>=&gt; =&gt; transferring dockerfile: 364B                                                                        0.0s
</span></span><span style=display:flex><span>=&gt; [internal] load .dockerignore                                                                           0.0s
</span></span><span style=display:flex><span>=&gt; =&gt; transferring context: 2B                                                                             0.0s
</span></span><span style=display:flex><span>=&gt; [internal] load metadata for docker.io/library/python:3.10-slim                                         1.6s
</span></span><span style=display:flex><span>=&gt; [auth] library/python:pull token for registry-1.docker.io                                               0.0s
</span></span><span style=display:flex><span>=&gt; [1/6] FROM docker.io/library/python:3.10-slim@sha256:54956d6c929405ff651516d5ebbc204203a6415c9d2757aad  0.0s
</span></span><span style=display:flex><span>=&gt; [internal] load build context                                                                           0.3s
</span></span><span style=display:flex><span>=&gt; =&gt; transferring context: 1.91kB                                                                         0.3s
</span></span><span style=display:flex><span>=&gt; CACHED [2/6] WORKDIR /app                                                                               0.0s
</span></span><span style=display:flex><span>=&gt; [3/6] COPY requirements.txt /app                                                                        0.0s
</span></span><span style=display:flex><span>=&gt; [4/6] RUN pip install -r requirements.txt                                                              15.3s
</span></span><span style=display:flex><span>=&gt; [5/6] RUN splk-py-trace-bootstrap                                                                       9.0s
</span></span><span style=display:flex><span>=&gt; [6/6] COPY ./review.py /app                                                                             0.0s
</span></span><span style=display:flex><span>=&gt; exporting to image                                                                                      0.6s
</span></span><span style=display:flex><span>=&gt; =&gt; exporting layers                                                                                     0.6s
</span></span><span style=display:flex><span>=&gt; =&gt; writing image sha256:164977dd860a17743b8d68bcc50c691082bd3bfb352d1025dc3a54b15d5f4c4d                0.0s
</span></span><span style=display:flex><span>=&gt; =&gt; naming to docker.io/localhost:8000/review-splkotel:0.01                                              0.0s
</span></span></code></pre></div></li><li><p>Push the image to Docker Hub with docker push command</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>docker push localhost:8000/review-splkotel:0.01
</span></span><span style=display:flex><span>The push refers to repository [docker.io/localhost:8000/review-splkotel]
</span></span><span style=display:flex><span>682f0e550f2c: Pushed
</span></span><span style=display:flex><span>dd7dfa312442: Pushed
</span></span><span style=display:flex><span>917fd8334695: Pushed
</span></span><span style=display:flex><span>e6782d51030d: Pushed
</span></span><span style=display:flex><span>c6b19a64e528: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>8f52e3bfc0ab: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>f90b85785215: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>d5c0beb90ce6: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>3759be374189: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>fd95118eade9: Mounted from localhost:8000/review
</span></span><span style=display:flex><span>0.01: digest: sha256:3b251059724dbb510ea81424fc25ed03554221e09e90ef965438da33af718a45 size: 2412
</span></span></code></pre></div></li></ul><h2 id=3-update-the-review-deployment-in-kubernetes>3. Update the REVIEW deployment in Kubernetes</h2><ul><li><p>review.deployment.yaml must be updated with the following changes:</p><ul><li>Load the new container image on Docker Hub</li><li>Add environment variables so traces can be emitted to the OTEL collector</li></ul></li><li><p>The deployment must be replaced using the updated review.deployment.yaml</p><ul><li>Update review.deployment.yaml (updates highlighted in bold)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>imagePullSecrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>regcred</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>localhost:8000/review-splkotel:0.01</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SPLUNK_OTEL_AGENT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>valueFrom</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>fieldRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>fieldPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>status.hostIP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_SERVICE_NAME</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;review&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SPLUNK_METRICS_ENDPOINT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://$(SPLUNK_OTEL_AGENT):9943&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_EXPORTER_OTLP_ENDPOINT</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OTEL_RESOURCE_ATTRIBUTES</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;deployment.environment=rtapp-workshop-stevel&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>hostPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/appdata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Apply review.deployment.yaml. Kubernetes will automatically pick up the changes to the deployment and redeploy new pods with these updates</p><ul><li>Notice that the review-* pod has been restarted</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>kubectl apply -f review.deployment.yaml
</span></span><span style=display:flex><span>deployment.apps/review configured
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get pods
</span></span><span style=display:flex><span>NAME                                                              READY   STATUS        RESTARTS   AGE
</span></span><span style=display:flex><span>kafka-client                                                      0/1     Unknown       0          155d
</span></span><span style=display:flex><span>curl                                                              0/1     Unknown       0          155d
</span></span><span style=display:flex><span>kafka-zookeeper-0                                                 1/1     Running       0          26h
</span></span><span style=display:flex><span>kafka-2                                                           2/2     Running       0          26h
</span></span><span style=display:flex><span>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running       2          26h
</span></span><span style=display:flex><span>mongodb-6f6c78c76-kl4vv                                           2/2     Running       0          26h
</span></span><span style=display:flex><span>kafka-1                                                           2/2     Running       1          26h
</span></span><span style=display:flex><span>kafka-0                                                           2/2     Running       1          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running       0          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running       0          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running       0          26h
</span></span><span style=display:flex><span>review-6686859bd7-4pf5d                                           1/1     Running       0          11s
</span></span><span style=display:flex><span>review-5dd8cfd77b-52jbd                                           0/1     Terminating   0          2d10h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get pods
</span></span><span style=display:flex><span>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>kafka-client                                                      0/1     Unknown   0          155d
</span></span><span style=display:flex><span>curl                                                              0/1     Unknown   0          155d
</span></span><span style=display:flex><span>kafka-zookeeper-0                                                 1/1     Running   0          26h
</span></span><span style=display:flex><span>kafka-2                                                           2/2     Running   0          26h
</span></span><span style=display:flex><span>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running   2          26h
</span></span><span style=display:flex><span>mongodb-6f6c78c76-kl4vv                                           2/2     Running   0          26h
</span></span><span style=display:flex><span>kafka-1                                                           2/2     Running   1          26h
</span></span><span style=display:flex><span>kafka-0                                                           2/2     Running   1          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running   0          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running   0          26h
</span></span><span style=display:flex><span>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running   0          26h
</span></span><span style=display:flex><span>review-6686859bd7-4pf5d                                           1/1     Running   0          15s
</span></span></code></pre></div></li></ul><footer class=footline></footer></article><article class=default><h1 id=monitor-system-logs-with-splunk-universal-forwarder>Monitor System Logs with Splunk Universal Forwarder</h1><p><strong>Objective:</strong> Learn how to monitor Linux system logs with the Universal Forwarder sending logs to Splunk Enterprise</p><p><strong>Duration</strong>: 10 Minutes</p><h2 id=scenario>Scenario</h2><p>You&rsquo;ve been tasked with monitoring the OS logs of the host running your Kubernetes cluster. We are going to utilize a script that will autodeploy the Splunk Universal Forwarder. You will then configure the Universal Forwarder to send logs to the Splunk Enterprise instance assigned to you.</p><h3 id=1-ensure-youre-in-the-correct-directory>1. Ensure You&rsquo;re in the Correct Directory</h3><ul><li>we will need to be in /home/ubuntu/session-2</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> /home/ubuntu/session-2
</span></span></code></pre></div><h3 id=2-review-the-universal-forwarder-install-script>2. Review the Universal Forwarder Install Script</h3><ul><li>Let&rsquo;s take a look at the script that will install the Universal Forwarder and Linux TA automatically for you.<ul><li>This script is primarily used for remote instances.</li><li>Note we are not using a deployment server in this lab, however it is recommended in production we do that.</li><li>What user are we installing Splunk as?</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/sh  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic># This EXAMPLE script shows how to deploy the Splunk universal forwarder</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># to many remote hosts via ssh and common Unix commands.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For &#34;real&#34; use, this script needs ERROR DETECTION AND LOGGING!!</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># --Variables that you must set -----</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set username using by splunkd to run.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>SPLUNK_RUN_USER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ubuntu&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Populate this file with a list of hosts that this script should install to,</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># with one host per line. This must be specified in the form that should</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># be used for the ssh login, ie. username@host</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Example file contents:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># splunkuser@10.20.13.4</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># splunkker@10.20.13.5</span>
</span></span><span style=display:flex><span>  <span style=color:#000>HOSTS_FILE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;myhost.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This should be a WGET command that was *carefully* copied from splunk.com!!</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Sign into splunk.com and go to the download page, then look for the wget</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># link near the top of the page (once you have selected your platform)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># copy and paste your wget command between the &#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>WGET_CMD</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;wget -O splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz &#39;https://download.splunk.com/products/universalforwarder/releases/9.0.3/linux/splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#39;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the install file name to the name of the file that wget downloads</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># (the second argument to wget)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>INSTALL_FILE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># After installation, the forwarder will become a deployment client of this</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># host.  Specify the host and management (not web) port of the deployment server</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># that will be managing these forwarder instances.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Example 1.2.3.4:8089</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  DEPLOY_SERVER=&#34;x.x.x.x:8089&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># After installation, the forwarder can have additional TA&#39;s added to the </span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># /app directory please provide the local where TA&#39;s will be. </span>
</span></span><span style=display:flex><span>  <span style=color:#000>TA_INSTALL_DIRECTORY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/home/ubuntu/session-2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the seed app folder name for deploymentclien.conf</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  DEPLOY_APP_FOLDER_NAME=&#34;seed_all_deploymentclient&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the new Splunk admin password</span>
</span></span><span style=display:flex><span>  <span style=color:#000>PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;buttercup&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>REMOTE_SCRIPT_DEPLOY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  cd /opt
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  sudo </span><span style=color:#000>$WGET_CMD</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  sudo tar xvzf </span><span style=color:#000>$INSTALL_FILE</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  sudo rm </span><span style=color:#000>$INSTALL_FILE</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo useradd </span><span style=color:#000>$SPLUNK_RUN_USER</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  sudo find </span><span style=color:#000>$TA_INSTALL_DIRECTORY</span><span style=color:#4e9a06> -name &#39;*.tgz&#39; -exec tar xzvf {} --directory /opt/splunkforwarder/etc/apps \;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  sudo chown -R </span><span style=color:#000>$SPLUNK_RUN_USER</span><span style=color:#4e9a06>:</span><span style=color:#000>$SPLUNK_RUN_USER</span><span style=color:#4e9a06> /opt/splunkforwarder
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  echo \&#34;[user_info] 
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  USERNAME = admin
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  PASSWORD = </span><span style=color:#000>$PASSWORD</span><span style=color:#4e9a06>\&#34; &gt; /opt/splunkforwarder/etc/system/local/user-seed.conf   
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo cp </span><span style=color:#000>$TA_INSTALL_DIRECTORY</span><span style=color:#4e9a06>/*.tgz /opt/splunkforwader/etc/apps/
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo find /opt/splunkforwarder/etc/apps/ -name &#39;*.tgz&#39; -exec tar xzvf {} \;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo -u splunk /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span style=color:#000>$SPLUNK_RUN_USER</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span style=color:#000>$SPLUNK_RUN_USER</span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  #sudo cp </span><span style=color:#000>$TA_INSTALL_DIRECTORY</span><span style=color:#4e9a06>/*.tgz /opt/splunkforwarder/etc/apps/
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  exit
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> &#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>DIR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span> <span style=color:#204a87>cd</span> <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span> dirname <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>BASH_SOURCE</span><span style=color:#000;font-weight:700>[0]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span> &gt;/dev/null <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>pwd</span> <span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#===============================================================================================</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;In 5 seconds, will run the following script on each remote host:&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;====================&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$REMOTE_SCRIPT_DEPLOY</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;====================&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> 
</span></span><span style=display:flex><span>  sleep <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Reading host logins from </span><span style=color:#000>$HOSTS_FILE</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Starting.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> DST in <span style=color:#4e9a06>`</span>cat <span style=color:#4e9a06>&#34;</span><span style=color:#000>$DIR</span><span style=color:#4e9a06>/</span><span style=color:#000>$HOSTS_FILE</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[</span> -z <span style=color:#4e9a06>&#34;</span><span style=color:#000>$DST</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>continue</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;---------------------------&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Installing to </span><span style=color:#000>$DST</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Initial UF deployment&#34;</span>
</span></span><span style=display:flex><span>    sudo ssh -t <span style=color:#4e9a06>&#34;</span><span style=color:#000>$DST</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$REMOTE_SCRIPT_DEPLOY</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>done</span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;---------------------------&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Done&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Please use the following app folder name to override deploymentclient.conf options: </span><span style=color:#000>$DEPLOY_APP_FOLDER_NAME</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h3 id=3-run-the-install-script>3. Run the install script</h3><p>We will run the install script now. You will see some Warnings at the end. This is totally normal.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./install.sh
</span></span></code></pre></div><h3 id=4-verify-installation-of-the-universal-forwarader>4. Verify installation of the Universal Forwarader</h3><ul><li>We need to verify that the Splunk Universal Forwarder is installed and running.<ul><li>You should see a couple PID&rsquo;s return and a &ldquo;Splunk is currently running.&rdquo; message.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunkforwarder/bin/splunk status
</span></span></code></pre></div><h4 id=5-configure-the-universal-forwarder-to-send-data-to-splunk-enterprise>5. Configure the Universal Forwarder to Send Data to Splunk Enterprise.</h4><ul><li>We will be able to send the data to our Splunk Enterprise environment easily by entering one line into the cli.<ul><li><a href=https://docs.splunk.com/Documentation/Forwarder/9.0.3/Forwarder/Configuretheuniversalforwarder target=_blank>Universal Forwarder Config Guide</a></li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunkforwarder/bin/splunk add forward-server &lt;your_splunk_enterprise_ip&gt;:9997
</span></span></code></pre></div><h4 id=6-verify-the-data-in-your-splunk-enterprise-environment>6. Verify the Data in Your Splunk Enterprise Environment</h4><ul><li><p>We are now going to take a look at the Splunk Enterprise environment to verify logs are coming in.</p><ul><li>Logs will be coming into <code>index=main</code></li></ul></li><li><p>Open your web browser and navigate to: <code>http://&lt;your_splunk_enterprise_ip:8000</code></p><ul><li>You will use the credentials <code>admin:&lt;your_ssh_password></code></li></ul></li><li><p>In the search bar, type in the following:</p></li><li><p><code>index=main host=&lt;your_host_name></code></p></li><li><p>You should see data from your host. Take note of the interesting fields and the different data sources flowing in.</p></li></ul><footer class=footline></footer></article></section></div></main></div><script src=https://splunk.github.io/observability-workshop/v4.56/js/clipboard.min.js?1676474829 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/perfect-scrollbar.min.js?1676474829 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/theme.js?1676474829 defer></script></body></html>