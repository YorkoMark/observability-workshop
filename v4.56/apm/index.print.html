<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.11.2+tip"><meta name=description content="Splunk APM is a NoSample™ Full-fidelity application performance monitoring and troubleshooting solution for cloud-native, microservices-based applications."><title>Splunk APM :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.56/apm/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/v4.56/apm/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/v4.56/ja/apm/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/v4.56/apm/index.html rel=canonical type=text/html title="Splunk APM :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.56/apm/index.xml rel=alternate type=application/rss+xml title="Splunk APM :: Splunk Observability Cloud Workshops"><link href=https://splunk.github.io/observability-workshop/v4.56/images/favicon.ico?1676474828 rel=icon type=image/x-icon><link href=https://splunk.github.io/observability-workshop/v4.56/css/fontawesome-all.min.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/fontawesome-all.min.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/auto-complete.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/auto-complete.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/perfect-scrollbar.min.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/nucleus.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/fonts.css?1676474829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/fonts.css?1676474829 rel=stylesheet></noscript><link href=https://splunk.github.io/observability-workshop/v4.56/css/theme.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/theme-splunk-light.css?1676474829 rel=stylesheet id=variant-style><link href=https://splunk.github.io/observability-workshop/v4.56/css/ie.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/variant.css?1676474829 rel=stylesheet><link href=https://splunk.github.io/observability-workshop/v4.56/css/print.css?1676474829 rel=stylesheet media=print><link href=https://splunk.github.io/observability-workshop/v4.56/css/format-print.css?1676474829 rel=stylesheet><script src=https://splunk.github.io/observability-workshop/v4.56/js/url.js?1676474829></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/variant.js?1676474829></script>
<script>window.index_js_url="https://splunk.github.io/observability-workshop/v4.56/index.search.js";var root_url="https://splunk.github.io/observability-workshop/v4.56/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.56/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=https://splunk.github.io/observability-workshop/v4.56/apm/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable dir=ltr><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://splunk.github.io/observability-workshop/v4.56/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Splunk APM</span><meta itemprop=position content="2"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=splunk-apm>Splunk APM</h1><p>Splunk APM is a NoSample™ Full-fidelity application performance monitoring and troubleshooting solution for cloud-native, microservices-based applications.</p><p>By collecting all traces, instead of a sampled subset, no anomaly goes undetected. Whether a user experiences an error or longer-than-usual latency, you’ll be able to know and act on it within seconds. Furthermore, not all bad behavior results in errors — as your developers create new applications they need to know whether their canary releases provide the expected results. Only by collecting all trace data will you ensure that your cloud-native applications behave the way they are supposed to.</p><p>Infrastructure and application performance are interdependent. To see the full picture, Splunk APM provides seamless correlation between cloud infrastructure and the microservices running on top of it. If your application acts out because of memory leakage, a noisy neighbor container or any other infrastructure-related issue, Splunk will let you know. To complete the picture, in-context access to Splunk logs and events enable deeper troubleshooting and root-cause analysis.</p><p><a href=#image-2a6a096712e61af99a2c1f34b1d0dcaf class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/images/arch-overview.png alt="Architecture Overview" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2a6a096712e61af99a2c1f34b1d0dcaf><img src=https://splunk.github.io/observability-workshop/v4.56/apm/images/arch-overview.png alt="Architecture Overview" class=lightbox-image loading=lazy></a></p><div class="children children-h3 children-sort-"><h3><a href=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/index.html>1. Deploy the Online Boutique</a></h3><p>Deploy the Online Boutique application into Kubernetes (K3s) and generate some artificial traffic using Locust.</p><h3><a href=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/index.html>2. Using Splunk APM</a></h3><p>An overview of how to use Splunk APM</p></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk APM</h1><article class=default><h1 id=1-deploy-the-online-boutique>1. Deploy the Online Boutique</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li>Deploy the Online Boutique application into Kubernetes (K3s)</li><li>Verify the application is running</li><li>Generate some artificial traffic using Locust</li><li>See APM metrics in the UI</li></ul><hr><h2 id=1-check-your-ec2-server>1. Check your EC2 server</h2><p>This workshop module assumes you are running this after you have run the IM workshop, and still have access to your EC2 instance.</p><p>If this is the case, continue with <a href=#2-deploy-online-boutique>Deploy Online Boutique</a>, otherwise if you have received a fresh instance, please run the first two (2) sections of <a href=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../../../../imt/gdi/>Deploy the OTel Collector</a> to get the system ready for the APM workshop, then continue with the next section.</p><h2 id=2-deploy-online-boutique>2. Deploy Online Boutique</h2><p>To deploy the Online Boutique application into K3s, run the <code>apm-config.sh</code> script, then apply the deployment:</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Deploy Online Boutique" class="tab-nav-button direction-ltr active" onclick='switchTab("default","Deploy Online Boutique")'>
<span>Deploy Online Boutique</span></button>
<button data-tab-item="Deployment Output" class="tab-nav-button direction-ltr" onclick='switchTab("default","Deployment Output")'>
<span>Deployment Output</span></button></div><div class=tab-content><div data-tab-item="Deploy Online Boutique" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/workshop/apm
</span></span><span style=display:flex><span>./apm-config.sh
</span></span><span style=display:flex><span>kubectl apply -f deployment.yaml
</span></span></code></pre></div></div><div data-tab-item="Deployment Output" class=tab-content-text><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>APM Only Deployment
</span></span><span style=display:flex><span>deployment.apps/recommendationservice created
</span></span><span style=display:flex><span>service/recommendationservice created
</span></span><span style=display:flex><span>deployment.apps/productcatalogservice created
</span></span><span style=display:flex><span>service/productcatalogservice created
</span></span><span style=display:flex><span>deployment.apps/cartservice created
</span></span><span style=display:flex><span>service/cartservice created
</span></span><span style=display:flex><span>deployment.apps/adservice created
</span></span><span style=display:flex><span>service/adservice created
</span></span><span style=display:flex><span>deployment.apps/paymentservice created
</span></span><span style=display:flex><span>service/paymentservice created
</span></span><span style=display:flex><span>deployment.apps/loadgenerator created
</span></span><span style=display:flex><span>service/loadgenerator created
</span></span><span style=display:flex><span>deployment.apps/shippingservice created
</span></span><span style=display:flex><span>service/shippingservice created
</span></span><span style=display:flex><span>deployment.apps/currencyservice created
</span></span><span style=display:flex><span>service/currencyservice created
</span></span><span style=display:flex><span>deployment.apps/redis-cart created
</span></span><span style=display:flex><span>service/redis-cart created
</span></span><span style=display:flex><span>deployment.apps/checkoutservice created
</span></span><span style=display:flex><span>service/checkoutservice created
</span></span><span style=display:flex><span>deployment.apps/frontend created
</span></span><span style=display:flex><span>service/frontend created
</span></span><span style=display:flex><span>service/frontend-external created
</span></span><span style=display:flex><span>deployment.apps/emailservice created
</span></span><span style=display:flex><span>service/emailservice created
</span></span><span style=display:flex><span>deployment.apps/rum-loadgen-deployment created
</span></span></code></pre></div></div></div></div><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> In case of a message about a VARIABLE being unset</div><div class=box-content><p>Delete the deployment running <code>kubectl delete -f deployment.yaml</code>.</p><p>Then, export the variable as described in the guide/message, followed by re-running the deployment script above.</p></div></div><p>To ensure the Online Boutique application is running:</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Get Pods" class="tab-nav-button direction-ltr active" onclick='switchTab("default","Get Pods")'>
<span>Get Pods</span></button>
<button data-tab-item="Get Pods Output" class="tab-nav-button direction-ltr" onclick='switchTab("default","Get Pods Output")'>
<span>Get Pods Output</span></button></div><div class=tab-content><div data-tab-item="Get Pods" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div></div><div data-tab-item="Get Pods Output" class=tab-content-text><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NAME                                                       READY  STATUS  RESTARTS      AGE
</span></span><span style=display:flex><span>splunk-otel-collector-k8s-cluster-receiver-849cf595bf-l7mnq 1/1   Running   0           31m
</span></span><span style=display:flex><span>splunk-otel-collector-agent-pxrgp                           2/2   Running   0           31m
</span></span><span style=display:flex><span>productcatalogservice-8464cd56d-n8f89                       1/1   Running   0            1m
</span></span><span style=display:flex><span>redis-cart-bcf44df97-djv6z                                  1/1   Running   0            1m
</span></span><span style=display:flex><span>checkoutservice-8558fd7b95-b9pn8                            1/1   Running   0            1m
</span></span><span style=display:flex><span>shippingservice-7cc4bdd6f4-xsvnx                            1/1   Running   0            1m
</span></span><span style=display:flex><span>recommendationservice-647d57fd44-l7tkq                      1/1   Running   0            1m
</span></span><span style=display:flex><span>frontend-66c5d589d-55vzb                                    1/1   Running   0            1m
</span></span><span style=display:flex><span>emailservice-6ff5bbd67d-pdcm2                               1/1   Running   0            1m
</span></span><span style=display:flex><span>paymentservice-6866558995-8xmf2                             1/1   Running   0            1m
</span></span><span style=display:flex><span>currencyservice-8668d75d6f-mr68h                            1/1   Running   0            1m
</span></span><span style=display:flex><span>rum-loadgen-deployment-58ccf7bd8f-cr4pr                     1/1   Running   0            1m
</span></span><span style=display:flex><span>rum-loadgen-deployment-58ccf7bd8f-qjr4b                     1/1   Running   0            1m
</span></span><span style=display:flex><span>rum-loadgen-deployment-58ccf7bd8f-fvb4x                     1/1   Running   0            1m
</span></span><span style=display:flex><span>cartservice-7b58c88c45-xvxhq                                1/1   Running   0            1m
</span></span><span style=display:flex><span>loadgenerator-6bdc7b4857-9kxjd                              1/1   Running   2 (49s ago)  1m
</span></span><span style=display:flex><span>adservice-7b68d5b969-89ft2                                  1/1   Running   0            1m
</span></span></code></pre></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>Usually it should only take around 1min 30secs for the pods to transition into a Running state.</p></div></div><hr><h2 id=4-validate-in-the-ui>4. Validate in the UI</h2><p>In the Splunk UI click on <strong>Infrastructure</strong> this will bring you to the Infrastructure Overview dashboard, then click on <strong>Kubernetes</strong>.</p><p>Use the <strong>Cluster</strong> dropdown so select your Cluster, you should see the new pods started and containers deployed. When you click on your Cluster in the Splunk UI you should have a view that looks like below:</p><p><a href=#image-8b7b57d5f58665320debca597584ca3d class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique-k8s.png alt="Back to cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8b7b57d5f58665320debca597584ca3d><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique-k8s.png alt="Back to cluster" class=lightbox-image loading=lazy></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you should now see that there are a number of Deployments and ReplicaSets:</p><p><a href=#image-b63c6629881a45700f01ade303d5f5e9 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique-workload.png alt="Online Boutique loaded" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b63c6629881a45700f01ade303d5f5e9><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique-workload.png alt="Online Boutique loaded" class=lightbox-image loading=lazy></a></p><hr><h2 id=5-view-online-boutique>5. View Online Boutique</h2><p>The Online Boutique is viewable on port 81 of the EC2 instance&rsquo;s IP address. The IP address is the one you used to SSH into the instance at the beginning of the workshop.</p><p>Open your web browser and go to <code>http://&lt;ec2-ip-address>:81/</code> where you will then be able to see the Online Boutique running.</p><p><a href=#image-695107783e1c44613001c96d4d72d7a5 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-695107783e1c44613001c96d4d72d7a5><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/../images/online-boutique.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of 1. Deploy the Online Boutique</h1><article class=default><h1 id=11-generate-load-using-locust>1.1 Generate load using Locust</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
5 minutes</button></span><h2 id=1-generate-traffic>1. Generate traffic</h2><p>The Online Boutique deployment contains a container running Locust that we can use to generate load traffic against the website to generate metrics, traces and spans.</p><p>Locust is available on port 82 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://&lt;ec2-ip-address>:82/</code>, you will then be able to see the Locust running.</p><p><a href=#image-5a19bc7c82874718e76a6b76c6963cdb class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust.png alt=Locust style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5a19bc7c82874718e76a6b76c6963cdb><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust.png alt=Locust class=lightbox-image loading=lazy></a></p><p>Set the <strong>Spawn rate</strong> to be 2 and click <strong>Start Swarming</strong>, this will start a gentle continous load on the application.</p><p><a href=#image-3d9c049f32c60a26e6893e15198f5ecb class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust-spawn-rate.png alt="Spawn Rate" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3d9c049f32c60a26e6893e15198f5ecb><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust-spawn-rate.png alt="Spawn Rate" class=lightbox-image loading=lazy></a></p><p><a href=#image-2133881e64f3335c367d46ceb60d6fe9 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust-statistics.png alt=Statistics style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2133881e64f3335c367d46ceb60d6fe9><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/locust-statistics.png alt=Statistics class=lightbox-image loading=lazy></a></p><hr><p>Now go to <strong>Dashboards → All Dashboards → APM Services → Service</strong>.</p><p>For this we need to know the name of your application environment. In this workshop all the environments use: <code>&lt;hostname>-apm-env</code>.</p><p>To find the hostname, on the AWS/EC2 instance run the following command:</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Echo Hostname" class="tab-nav-button direction-ltr active" onclick='switchTab("default","Echo Hostname")'>
<span>Echo Hostname</span></button>
<button data-tab-item="Output Example" class="tab-nav-button direction-ltr" onclick='switchTab("default","Output Example")'>
<span>Output Example</span></button></div><div class=tab-content><div data-tab-item="Echo Hostname" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#204a87;font-weight:700>$(</span>hostname<span style=color:#204a87;font-weight:700>)</span>-apm-env
</span></span></code></pre></div></div><div data-tab-item="Output Example" class=tab-content-text><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>bdzx-apm-env
</span></span></code></pre></div></div></div></div><p>Select your environment you found in the previous step then select the <code>frontend</code> service and set time to Past 15 minutes.</p><p><a href=#image-205960a5e926a5bd152aaca62e9ef852 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-service-dashboard.png alt="APM Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-205960a5e926a5bd152aaca62e9ef852><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-service-dashboard.png alt="APM Dashboard" class=lightbox-image loading=lazy></a></p><p>With this automatically generated dashboard you can keep an eye out for the health of your service(s) using RED (Rate, Error & Duration) metrics. It provides various performance related charts as well as correlated information on the underlying host and Kubernetes pods (if applicable).</p><p>Take some time to explore the various charts in this dashboard</p><hr><h2 id=2-verify-splunk-apm-metrics>2. Verify Splunk APM metrics</h2><p>In the left hand menu card click on <strong>APM</strong> this will bring you to the APM Overview dashboard:</p><p><a href=#image-e3b433ada23dc4fbc5bb23a2f86a8d62 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-apm.png alt="select APM" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e3b433ada23dc4fbc5bb23a2f86a8d62><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-apm.png alt="select APM" class=lightbox-image loading=lazy></a></p><p>Select the <strong>Explore</strong> on the right hand side and select your environment you found before and set the time to 15 minutes. This will show you the automatically generated Dependency/Service Map for the Online Boutique application.</p><p>It should look similar to the screenshot below:</p><p><a href=#image-7692331748a9f620c2834d86dc1a17d0 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-map.png alt="Online Boutique in APM" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7692331748a9f620c2834d86dc1a17d0><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/online-boutique-map.png alt="Online Boutique in APM" class=lightbox-image loading=lazy></a></p><p>The legend at the bottom of the page explains the different visualizations in the Dependency/Service Map.</p><p><a href=#image-5a3e9258a1e01ab34285f7994bbc9c95 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/apm-legend.png alt="APM Legend" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5a3e9258a1e01ab34285f7994bbc9c95><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/apm-legend.png alt="APM Legend" class=lightbox-image loading=lazy></a></p><ul><li>Service requests, error rate and root error rate.</li><li>Request rate, latency and error rate</li></ul><p>Also in this view you can see the overall Error and Latency rates over time charts.</p><h2 id=3-opentelemetry-dashboard>3. OpenTelemetry Dashboard</h2><p>Once the Open Telemetery Collector is deployed the platform will automatically provide a built in dashboard display OpenTelemetry Collector metrics.</p><p>From the top left hamburger menu <strong>Dashboards → OpenTelemetry Collector</strong>, scroll all the way to the bottom of the page and validate metrics and spans are being sent:</p><p><a href=#image-6bf48e7b0160d12addfe63345170f159 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/otel-dashboard.png alt="OpenTelemetry Collector dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6bf48e7b0160d12addfe63345170f159><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/otel-dashboard.png alt="OpenTelemetry Collector dashboard" class=lightbox-image loading=lazy></a></p><h2 id=4-opentelemetry-zpages>4. OpenTelemetry zpages</h2><p>To debug the traces being sent you can use the zpages extension. <a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/experimental/trace/zpages.md#tracez target=_blank>zpages</a> are part of the OpenTelemetry collector and provide live data for troubleshooting and statistics. They are available on port <code>55679</code> of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and enter in <code>http://{==EC2-IP==}:55679/debug/tracez</code>, you will then be able to see the zpages output.</p><p><a href=#image-cc358aeab4d371cd4498fd803fb0c13a class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/zpages.png alt=zpages style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cc358aeab4d371cd4498fd803fb0c13a><img src=https://splunk.github.io/observability-workshop/v4.56/apm/online-boutique/locust/../../images/zpages.png alt=zpages class=lightbox-image loading=lazy></a></p><p>Alternatively, from your shell prompt you can run a text based browser:</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Lynx Command" class="tab-nav-button direction-ltr active" onclick='switchTab("default","Lynx Command")'>
<span>Lynx Command</span></button></div><div class=tab-content><div data-tab-item="Lynx Command" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lynx http://localhost:55679/debug/tracez
</span></span></code></pre></div></div></div></div><footer class=footline></footer></article></section><article class=default><h1 id=2-using-splunk-apm>2. Using Splunk APM</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li>APM Overview - RED metrics</li><li>Using the Service Map</li><li>Introduction to Tag Spotlight</li><li>Example Traces</li><li>Contextual Links to Infra</li></ul><h2 id=1-traces-and-spans-explained>1. Traces and Spans explained</h2><p>A trace is a collection of spans that share the same trace ID, representing a unique transaction handled by your application and its constituent services.</p><p><a href=#image-033a1487270e20112489a0bf379d610b class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/../images/trace-spans.png alt="Traces and Spans" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-033a1487270e20112489a0bf379d610b><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/../images/trace-spans.png alt="Traces and Spans" class=lightbox-image loading=lazy></a></p><p>Each span has a name, representing the operation captured by this span, and a service name, representing within which service the operation took place.</p><p>Additionally, spans may reference another span as their parent, defining the relationships between the operations captured in the trace that were performed to process that transaction.</p><p>Each span contains a lot of information about the method, operation, or block of code that it captures, including:</p><ul><li>the operation name</li><li>the start time of the operation with microsecond precision</li><li>how long the operation took to execute, also with microsecond precision</li><li>the logical name of the service on which the operation took place</li><li>the IP address of the service instance on which the operation took place</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of 2. Using Splunk APM</h1><article class=default><h1 id=21-service-map>2.1 Service Map</h1><h2 id=service-map>Service Map</h2><p>Click on <strong>paymentservice</strong> in the service map and select <strong>version</strong> from the <code>breakdown</code> drop down filter underneath <strong>paymentservice</strong>. This will filter our service map by the custom span tag <strong>version</strong>.</p><p>You will now see the service map has been updated like the below screenshot to show the different versions of the <strong>paymentservice</strong>.</p><p><a href=#image-fd2bf3ea679d6172495e2545ad31e260 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/service_map/../../images/paymentservice.png alt="Payment Service" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fd2bf3ea679d6172495e2545ad31e260><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/service_map/../../images/paymentservice.png alt="Payment Service" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><h1 id=22-tag-spotlight>2.2 Tag Spotlight</h1><h2 id=tag-spotlight>Tag Spotlight</h2><p>On the right hand side of the screen scroll down on <strong>Tag Spotlight</strong>, ensure <strong>Top Across All Indexed Tags</strong> is selected in the dropdown click the full screen button as indicated in the screenshot below.</p><p><a href=#image-d41a851c7d05e12933d3562615418a4e class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight.png alt="Tag Spotlight" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d41a851c7d05e12933d3562615418a4e><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight.png alt="Tag Spotlight" class=lightbox-image loading=lazy></a></p><p>The Tag Spotlight Page will be displayed. From this page you can view the top tags in your application and their corresponding error rates and request rates.</p><p>Note that for the <strong>version</strong> span tag it appears that version <code>350.10</code> has a 100% error rate and for our <strong>tenant.level</strong> span tag it shows that all three tenants (Gold, Silver & Bronze) have errors present.</p><p><a href=#image-3d325f650f9d911cf74d8ecb169cdc38 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight-dashboard.png alt="Tag Spotlight Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3d325f650f9d911cf74d8ecb169cdc38><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight-dashboard.png alt="Tag Spotlight Dashboard" class=lightbox-image loading=lazy></a></p><p>The Tag Spotlight page is interactive and allows you to add a tag as a filter by simply clicking on your desired tag. Click on <strong>gold</strong> under <strong>tenant.level</strong> to add it as a filter. Once this is done the page will now only display data with <strong>gold</strong> as it’s <strong>tenant.level</strong>.</p><p><a href=#image-917606e269430a8b02d638407509e7ee class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/gold-tenant.png alt="Gold Tenant" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-917606e269430a8b02d638407509e7ee><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/gold-tenant.png alt="Gold Tenant" class=lightbox-image loading=lazy></a></p><p>Tag Spotlight is very useful for analysing your data and spotting trends. We can see that for the Gold Tenant that out of the total number of requests, 55 of them are in error (this number will vary in your workshop).</p><p>If we correlate this to the version tag, we can see that version <code>350.10</code> served 55 requests and version <code>350.9</code> served 17 requests. This means that all of the requests that went through version <code>350.10</code> ended up in an error state.</p><p>In order to test this theory further that all of the requests from <strong>paymentservice</strong> version <code>350.10</code> result in an error, we can change our filter to another tenant by using the tag selector. Change your filter from <strong>gold</strong> tenant to <strong>silver</strong> tenant.</p><p><a href=#image-f3d77ad9e38a3c53364e153cb37387f6 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/silver-tag-filter.png alt="Silver Tag Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f3d77ad9e38a3c53364e153cb37387f6><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/silver-tag-filter.png alt="Silver Tag Filter" class=lightbox-image loading=lazy></a></p><p>Now we can perform a similar analysis by looking at the number of requests in error for the <strong>silver</strong> tenant and correlating that with the version number. Note the amount of errors for the <strong>silver</strong> tenant match the amount of requests for version <code>350.10</code>.</p><p><a href=#image-ad9a258d7ba2afb9793f1de8b319910d class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/silver-tenant.png alt="Silver Tenant" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ad9a258d7ba2afb9793f1de8b319910d><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/silver-tenant.png alt="Silver Tenant" class=lightbox-image loading=lazy></a></p><p>Tag Spotlight not only allows you to look at request and error rates but also at the latency per service. In order to do this just select the latency button and remove your Silver Tenant Tag so that you can see the latency for all of the Payment Service.</p><p><a href=#image-261c27549940d080fbed52220843395e class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/latency.png alt=Latency style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-261c27549940d080fbed52220843395e><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/tag_spotlight/../../images/latency.png alt=Latency class=lightbox-image loading=lazy></a></p><p>Go back to your service map by pressing the <strong>X</strong> button on the far right underneath <strong>Clear All</strong>.</p><p>Click anywhere on the pink line in the <strong>Services by Error Rate</strong> graph in the top right hand corner. Once selected you should see a list of example traces. Click on one of the example traces with an initiating operation of <strong>frontend: POST /cart/checkout</strong>.</p><footer class=footline></footer></article><article class=default><h1 id=23-example-trace>2.3 Example trace</h1><h2 id=example-trace>Example Trace</h2><p><a href=#image-97f24d6442b203d2f369193b98a76c90 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/example-trace.png alt="Example Trace" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-97f24d6442b203d2f369193b98a76c90><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/example-trace.png alt="Example Trace" class=lightbox-image loading=lazy></a></p><p>You should now see the entire trace along with the spans for the example trace that was selected. Spans which have errors are indicated by a red exclamation mark beside it. If you have a number such as <strong>x6</strong> in a grey box, click it to expand the compacted <code>paymentservice</code> spans.</p><p><a href=#image-526d526adfbd40e6573649ea9b293ff1 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/trace-span.png alt="Example Trace" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-526d526adfbd40e6573649ea9b293ff1><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/trace-span.png alt="Example Trace" class=lightbox-image loading=lazy></a></p><p>Now click one of the <code>paymentservice</code> spans with the red exclamation mark to expand it and see the associated metadata and some error details. Note that we are able to see that this error is caused by a 401 error and other useful information such as ‘tenant’ and ‘version’ is also displayed.</p><p><a href=#image-afad89926c649e1b139d4b0f395d4e0e class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/trace-metadata.png alt="Traces and Spans" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-afad89926c649e1b139d4b0f395d4e0e><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/trace-metadata.png alt="Traces and Spans" class=lightbox-image loading=lazy></a></p><p>So we now know that the error is caused by an <strong>Invalid Request</strong> but we don&rsquo;t know what exact request. At the bottom of the page you should see a contextual link to Logs, clink on this link to view the logs associated with this span.</p><p><a href=#image-6a80d6cefbc4caedf516e5c78aeaab16 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/logs_link.png alt="Logs Link" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6a80d6cefbc4caedf516e5c78aeaab16><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/logs_link.png alt="Logs Link" class=lightbox-image loading=lazy></a></p><p>You should now be looking at a <strong>Log Observer</strong> dashboard simialar to the image below.</p><p><a href=#image-cddb91bc093858bb6d6e1b6dda156119 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/log_observer.png alt="Log Observer" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cddb91bc093858bb6d6e1b6dda156119><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/log_observer.png alt="Log Observer" class=lightbox-image loading=lazy></a></p><p>We can use the filter to display only the error logs. Click on <code>ERROR</code> in the top right hand corner, then <code>Add to filter</code></p><p><a href=#image-d68e5624bbc9634165429c7f2b4ff6f6 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/error_filter.png alt="Error Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d68e5624bbc9634165429c7f2b4ff6f6><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/error_filter.png alt="Error Filter" class=lightbox-image loading=lazy></a></p><p>You should now have a shorter list of log entries which have a <code>severity</code> of <code>ERROR</code></p><p><a href=#image-776786885d5f29ff612d338cec439faf class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/filtered_results.png alt="Filtered Results" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-776786885d5f29ff612d338cec439faf><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/filtered_results.png alt="Filtered Results" class=lightbox-image loading=lazy></a></p><p>Select any of the entries to view the details. We can now see how the error was caused by the use of an <strong>Invalid API Token</strong> that our developers have accidentally pushed to production!</p><p><a href=#image-227eccaa5faedc145efda3a7754de3e9 class=lightbox-link><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/error_details.png alt="Error Details" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-227eccaa5faedc145efda3a7754de3e9><img src=https://splunk.github.io/observability-workshop/v4.56/apm/using-splunk-apm/example_trace/../../images/error_details.png alt="Error Details" class=lightbox-image loading=lazy></a></p><p><strong>Congratulations</strong>, you have now completed the APM Workshop.</p><footer class=footline></footer></article></section></section></div></main></div><script src=https://splunk.github.io/observability-workshop/v4.56/js/clipboard.min.js?1676474829 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/perfect-scrollbar.min.js?1676474829 defer></script>
<script src=https://splunk.github.io/observability-workshop/v4.56/js/theme.js?1676474829 defer></script></body></html>