<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/observability-workshop/v4.54/favicons/favicon.ico><link rel=apple-touch-icon href=/observability-workshop/v4.54/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/observability-workshop/v4.54/favicons/android-192x192.png sizes=192x192><title>Code to Kubernetes - Python | Splunk Observability Cloud Workshops</title><meta name=description content="Code to Kubernetes - Python Objective: Understand activities to instrument a python application and run it on Kubernetes.
Verify the code Containerize the app Deploy the container in Kubernetes Note: these steps do not involve Splunk
Duration: 15 Minutes
1. Verify the code - Review service Inspect review.py (workshop/flask_apps_start/review)
from flask import Flask, jsonify import random import subprocess review = Flask(__name__) num_reviews = 8635403 num_reviews = 100000 reviews_file = &amp;#39;/var/appdata/yelp_academic_dataset_review.json&amp;#39; @review."><meta property="og:title" content="Code to Kubernetes - Python"><meta property="og:description" content="Code to Kubernetes - Python Objective: Understand activities to instrument a python application and run it on Kubernetes.
Verify the code Containerize the app Deploy the container in Kubernetes Note: these steps do not involve Splunk
Duration: 15 Minutes
1. Verify the code - Review service Inspect review.py (workshop/flask_apps_start/review)
from flask import Flask, jsonify import random import subprocess review = Flask(__name__) num_reviews = 8635403 num_reviews = 100000 reviews_file = '/var/appdata/yelp_academic_dataset_review.json' @review."><meta property="og:type" content="article"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v4.54/tko/session-2/docs/code_to_python/"><meta property="article:section" content="tko"><meta property="article:modified_time" content="2023-02-02T15:01:05-06:00"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta itemprop=name content="Code to Kubernetes - Python"><meta itemprop=description content="Code to Kubernetes - Python Objective: Understand activities to instrument a python application and run it on Kubernetes.
Verify the code Containerize the app Deploy the container in Kubernetes Note: these steps do not involve Splunk
Duration: 15 Minutes
1. Verify the code - Review service Inspect review.py (workshop/flask_apps_start/review)
from flask import Flask, jsonify import random import subprocess review = Flask(__name__) num_reviews = 8635403 num_reviews = 100000 reviews_file = '/var/appdata/yelp_academic_dataset_review.json' @review."><meta itemprop=dateModified content="2023-02-02T15:01:05-06:00"><meta itemprop=wordCount content="1260"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Code to Kubernetes - Python"><meta name=twitter:description content="Code to Kubernetes - Python Objective: Understand activities to instrument a python application and run it on Kubernetes.
Verify the code Containerize the app Deploy the container in Kubernetes Note: these steps do not involve Splunk
Duration: 15 Minutes
1. Verify the code - Review service Inspect review.py (workshop/flask_apps_start/review)
from flask import Flask, jsonify import random import subprocess review = Flask(__name__) num_reviews = 8635403 num_reviews = 100000 reviews_file = '/var/appdata/yelp_academic_dataset_review.json' @review."><link rel=preload href=/observability-workshop/v4.54/scss/main.min.0e73693ebf0ee8a544416f412294cfbba2caebea9d2f0b07dc913f9e826b1ca6.css as=style><link href=/observability-workshop/v4.54/scss/main.min.0e73693ebf0ee8a544416f412294cfbba2caebea9d2f0b07dc913f9e826b1ca6.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar1><a class=navbar-brand href=/observability-workshop/v4.54/><span class=navbar-logo><img class=navbar-logo src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAIAAAD8RQT7AAACwklEQVRYw+2YW2jTYBTHu4l4F1ERVMQL+qKgMBUU9EEfRAURUUFfBEUEBRGfdC+CrVt3cdbNSZ1zXqar024yp9MJKzh3FScyO+q8MDW3pvc2TZqkudSvtD4J66fkWyL0kNeQH8mX8/+dY8JMZuNcpjzNX9JQK64ZiEZlk9zDEe/aOmPQ8FIKlJpKtH+mNzUYg+Z38a7vvu2NRqHJlDhABPY0G4UmU8lhOnioFSu0GIImU9KXUOhYOz75kiFoMiVjsfDpl/i0UrQ0oePPkp5ACq5kHxs978JnlaHsxQVm/24H3zUGyaRE+Jj5DTGvEm0yeNfVsfeGVVGGYQJtk6kaIBfZ0OYUufBKrKRHCSWgmAQ5fmOIWl6DNjXx6dbwqRfgh4L6eJLC3v/oXW1HnOGFlsDeR0L3TygmEC+tn+j19ciNgt5Qzznc4B3AUPGd33xb7yL3G3LJVaaiX4kKMExCD+bf2YTctvCZZZEzndJYBIZJfE8F9jtBE0HsfpMswQNOoR+HYWIbPkyQiQIr4pyelKyOQ5No8UyoF1PLahjboMqIhqABl3/HA6EX05kGyEboSBuQIZ2/FDGnInKuSyaZnKcYLU32lMTF3P05ITHVb8nFNiQ09MZbXPPI+H9QliMuMuV9xIIqBN2vwAy8HTKw0gJ0sZuYW6l9MuBTS8MnnkujQSgOPxctdhGzy7VPTWL+5eiF1+ABUJJKMpGzr4CHaG8U1KrauH0IHEAot/kRDZ/swKeUaG9bvi13Em2jKUWF4gDDzdGn/zbcmHJE4MEWcZCAFPWk2xc8/ATcpbGl4zOsYFCC1IOsIex7/KchaEMj0ywkh9CH+3c59J8104uLbY36T758x1d68229twIZ+y+6qffGRFa5Jrd3jR3Td5ukJhVgr9TKWp03benp9fo7cmm1/lvImLUXDN757XWe5v+g+QU6sNkgKUPrgwAAAABJRU5ErkJggg=="></span><span class=font-weight-bold>Splunk Observability Cloud Workshops</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div></nav><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" id=navbar2><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/observability-workshop/v4.54/imt/><i class='fa-regular fa-sitemap'></i><span>Splunk IM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/observability-workshop/v4.54/apm/><i class='fa-solid fa-code-fork'></i><span>Splunk APM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/observability-workshop/v4.54/synthetics/><i class='fa-brands fa-chrome'></i><span>Splunk Synthetics</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/observability-workshop/v4.54/rum/><i class='fa-regular fa-chalkboard-user'></i><span>Splunk RUM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/observability-workshop/v4.54/oncall/><i class="fa-regular fa-phone-flip"></i><span>Splunk OnCall</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>More Workshops</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://splunk.github.io/observability-workshop/latest/pet-clinic/>Pet Clinic Java Workshop</a>
<a class=dropdown-item href=https://splunk.github.io/observability-workshop/latest/bootcamp/>O11y Bootcamp</a>
<a class=dropdown-item href=https://splunk.github.io/observability-workshop/latest/resources/>Resources</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://splunk.github.io/observability-workshop/latest/>latest</a>
<a class=dropdown-item href=https://splunk.github.io/observability-workshop/v4.53>v4.53</a>
<a class=dropdown-item href=https://splunk.github.io/observability-workshop/v4.54>v4.54</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/observability-workshop/v4.54/ja/>日本語</a></div></li></ul></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/observability-workshop/v4.54/offline-search-index.dd951ac1c98794d85a942e6a9fe80b1f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/observability-workshop/v4.54/ja/>日本語</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-observability-workshopv454tko-li><a href=/observability-workshop/v4.54/tko/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-observability-workshopv454tko><span>TKO Workshops</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-1-li><a href=/observability-workshop/v4.54/tko/session-1/ title="1. Role Play Qualification / Discovery - with SRE and ITOPs" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-1><span>Session 1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-observability-workshopv454tkosession-2-li><a href=/observability-workshop/v4.54/tko/session-2/ title="2. Getting Data In (GDI) & OTEL" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-2><span>Session 2</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-2docsintro-li><a href=/observability-workshop/v4.54/tko/session-2/docs/intro/ title="Intro to O11y GDI - Real Time Enrichment Workshop" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docsintro><span>Introduction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-2docsgetting_started-li><a href=/observability-workshop/v4.54/tko/session-2/docs/getting_started/ title="Getting Started with O11y GDI - Real Time Enrichment Workshop" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docsgetting_started><span>Getting started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-2docsdeploy-li><a href=/observability-workshop/v4.54/tko/session-2/docs/deploy/ title="Deploy complex environments and capture meterics" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docsdeploy><span>Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-observability-workshopv454tkosession-2docscode_to_python-li><a href=/observability-workshop/v4.54/tko/session-2/docs/code_to_python/ title="Code to Kubernetes - Python" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docscode_to_python><span class=td-sidebar-nav-active-item>Code to Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-2docsinstrument-li><a href=/observability-workshop/v4.54/tko/session-2/docs/instrument/ title="Instrument REVIEWS for Tracing" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docsinstrument><span>Instrumentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-2docsforwarder-li><a href=/observability-workshop/v4.54/tko/session-2/docs/forwarder/ title="Monitor System Logs with Splunk Universal Forwarder" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-2docsforwarder><span>UF Deployment</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-3-li><a href=/observability-workshop/v4.54/tko/session-3/ title="3. ITOps Monitoring Monitoring Monitoring" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-3><span>Session 3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-4-li><a href=/observability-workshop/v4.54/tko/session-4/ title="4. ITOps - Understanding Event Analytics in Realistic Business Services" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-4><span>Session 4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv454tkosession-5-li><a href=/observability-workshop/v4.54/tko/session-5/ title="5. How Platform Engineers Observe Kubernetes - Workshop" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-5><span>Session 5</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docsdeploy-otel-li><a href=/observability-workshop/v4.54/tko/session-5/docs/deploy-otel/ title="Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docsdeploy-otel><span>Deploying the OTel Collector</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docscheck-new-navigator-li><a href=/observability-workshop/v4.54/tko/session-5/docs/check-new-navigator/ title="The New Kubernetes Navigator" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docscheck-new-navigator><span>Touring the Kubernetes Navigator v2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docsdeploy-apache-li><a href=/observability-workshop/v4.54/tko/session-5/docs/deploy-apache/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docsdeploy-apache><span>Deploying PHP/Apache</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docsfix-apache-li><a href=/observability-workshop/v4.54/tko/session-5/docs/fix-apache/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docsfix-apache><span>Fix PHP/Apache Issue</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docsdeploy-loadgen-li><a href=/observability-workshop/v4.54/tko/session-5/docs/deploy-loadgen/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docsdeploy-loadgen><span>Deploy Load Generator</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docssetup-hpa-li><a href=/observability-workshop/v4.54/tko/session-5/docs/setup-hpa/ title="Setup Horizontal Pod Autoscaling (HPA)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docssetup-hpa><span>Setup HPA</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-5docsedit-hpa-li><a href=/observability-workshop/v4.54/tko/session-5/docs/edit-hpa/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-5docsedit-hpa><span>Increase HPA Replicas</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-observability-workshopv454tkosession-6-li><a href=/observability-workshop/v4.54/tko/session-6/ title="6. O11y - Distributed Tracing for modern applications" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-observability-workshopv454tkosession-6><span>Session 6</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docssetup-li><a href=/observability-workshop/v4.54/tko/session-6/docs/setup/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docssetup><span>Setup</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsvalidate_traces-li><a href=/observability-workshop/v4.54/tko/session-6/docs/validate_traces/ title="Validate Traces are being collected" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsvalidate_traces><span>Validate Traces</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsdeveloper_role-li><a href=/observability-workshop/v4.54/tko/session-6/docs/developer_role/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsdeveloper_role><span>Developer Role</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docscustom_attribution-li><a href=/observability-workshop/v4.54/tko/session-6/docs/custom_attribution/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docscustom_attribution><span>Custom Attribution</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsfix_issue-li><a href=/observability-workshop/v4.54/tko/session-6/docs/fix_issue/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsfix_issue><span>Fix the issue</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsroot_cause-li><a href=/observability-workshop/v4.54/tko/session-6/docs/root_cause/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsroot_cause><span>Root Cause Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsbuild_again-li><a href=/observability-workshop/v4.54/tko/session-6/docs/build_again/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsbuild_again><span>Build and Deploy again</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-observability-workshopv454tkosession-6docsfinal_fix-li><a href=/observability-workshop/v4.54/tko/session-6/docs/final_fix/ title="The Final Fix!" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-observability-workshopv454tkosession-6docsfinal_fix><span>Developer Role (Part 2)</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#code-to-kubernetes---python>Code to Kubernetes - Python</a></li><li><a href=#1-verify-the-code---review-service>1. Verify the code - Review service</a></li><li><a href=#2-create-a-review-container>2. Create a REVIEW container</a></li><li><a href=#3-run-review-in-kubernetes>3. Run REVIEW in Kubernetes</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://splunk.github.io/observability-workshop/v4.54/tko/>TKO Workshops</a></li><li class=breadcrumb-item><a href=https://splunk.github.io/observability-workshop/v4.54/tko/session-2/>Session 2</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://splunk.github.io/observability-workshop/v4.54/tko/session-2/docs/code_to_python/ aria-disabled=true class="btn-link disabled">Code to Kubernetes</a></li></ol></nav><div class=td-content><h1>Code to Kubernetes - Python</h1><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 6 minute read &nbsp;</p></header><h2 id=code-to-kubernetes---python>Code to Kubernetes - Python</h2><p><strong>Objective:</strong> Understand activities to instrument a python application and run it on Kubernetes.</p><ul><li>Verify the code</li><li>Containerize the app</li><li>Deploy the container in Kubernetes</li></ul><p><strong>Note:</strong> these steps do not involve Splunk</p><p><strong>Duration:</strong> 15 Minutes</p><h2 id=1-verify-the-code---review-service>1. Verify the code - Review service</h2><p>Inspect review.py (workshop/flask_apps_start/review)</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>flask</span> <span style=color:#069;font-weight:700>import</span> Flask, jsonify
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>subprocess</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>review <span style=color:#555>=</span> Flask(__name__)
</span></span><span style=display:flex><span>num_reviews <span style=color:#555>=</span> <span style=color:#f60>8635403</span>
</span></span><span style=display:flex><span>num_reviews <span style=color:#555>=</span> <span style=color:#f60>100000</span>
</span></span><span style=display:flex><span>reviews_file <span style=color:#555>=</span> <span style=color:#c30>&#39;/var/appdata/yelp_academic_dataset_review.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#99f>@review.route</span>(<span style=color:#c30>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>hello_world</span>():
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> jsonify(message<span style=color:#555>=</span><span style=color:#c30>&#39;Hello, you want to hit /get_review. We have &#39;</span> <span style=color:#555>+</span> <span style=color:#366>str</span>(num_reviews) <span style=color:#555>+</span> <span style=color:#c30>&#39; reviews!&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#99f>@review.route</span>(<span style=color:#c30>&#39;/get_review&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>get_review</span>():
</span></span><span style=display:flex><span>    random_review_int <span style=color:#555>=</span> <span style=color:#366>str</span>(random<span style=color:#555>.</span>randint(<span style=color:#f60>1</span>,num_reviews))
</span></span><span style=display:flex><span>    line_num <span style=color:#555>=</span> random_review_int <span style=color:#555>+</span> <span style=color:#c30>&#39;q;d&#39;</span>
</span></span><span style=display:flex><span>    command <span style=color:#555>=</span> [<span style=color:#c30>&#34;sed&#34;</span>, line_num, reviews_file] <span style=color:#09f;font-style:italic># sed &#34;7997242q;d&#34; &lt;file&gt;</span>
</span></span><span style=display:flex><span>    random_review <span style=color:#555>=</span> subprocess<span style=color:#555>.</span>run(command, stdout<span style=color:#555>=</span>subprocess<span style=color:#555>.</span>PIPE, text<span style=color:#555>=</span><span style=color:#069;font-weight:700>True</span>)
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> random_review<span style=color:#555>.</span>stdout
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>if</span> __name__ <span style=color:#555>==</span> <span style=color:#c30>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    review<span style=color:#555>.</span>run(host <span style=color:#555>=</span><span style=color:#c30>&#39;0.0.0.0&#39;</span>, port <span style=color:#555>=</span> <span style=color:#f60>5000</span>, debug <span style=color:#555>=</span> <span style=color:#069;font-weight:700>True</span>)
</span></span></code></pre></div><p>Inspect requirements.txt</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Flask==2.0.2
</span></span></code></pre></div><p>Create a virtual environment and Install the necessary python packages</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#366>cd</span> Workshop/flask_apps_start/review
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python3 -m venv rtapp-workshop
</span></span><span style=display:flex><span><span style=color:#366>source</span> rtapp-workshop/bin/activate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pip freeze <span style=color:#09f;font-style:italic>#note output</span>
</span></span><span style=display:flex><span>pip install -r requirements.txt
</span></span><span style=display:flex><span>pip freeze <span style=color:#09f;font-style:italic>#note output</span>
</span></span></code></pre></div><p>Start the REVIEW service. <strong>Note:</strong> You can stop the app with control+C</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 review.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Serving Flask app <span style=color:#c30>&#39;review&#39;</span> <span style=color:#555>(</span>lazy loading<span style=color:#555>)</span>
</span></span><span style=display:flex><span> * Environment: production
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span> * Running on http://10.160.145.246:5000/ <span style=color:#555>(</span>Press CTRL+C to quit<span style=color:#555>)</span>
</span></span><span style=display:flex><span> * Restarting with stat
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#555>[</span>17/May/2022 22:46:38<span style=color:#555>]</span> <span style=color:#c30>&#34;GET / HTTP/1.1&#34;</span> <span style=color:#f60>200</span> -
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#555>[</span>17/May/2022 22:47:02<span style=color:#555>]</span> <span style=color:#c30>&#34;GET /get_review HTTP/1.1&#34;</span> <span style=color:#f60>200</span> -
</span></span><span style=display:flex><span>127.0.0.1 - - <span style=color:#555>[</span>17/May/2022 22:47:58<span style=color:#555>]</span> <span style=color:#c30>&#34;GET /get_review HTTP/1.1&#34;</span> <span style=color:#f60>200</span> -
</span></span></code></pre></div><p>Verify that the service is working</p><ul><li>Use curl in your terminal</li><li>Or hit the URL <code>http://{Your_EC2_IP_address}:5000</code> and <code>http://{Your_EC2_IP_address}:5000/get_review</code> with a browser</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl localhost:5000
</span></span><span style=display:flex><span><span style=color:#555>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c30>&#34;message&#34;</span>: <span style=color:#c30>&#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#555>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl localhost:5000/get_review
</span></span><span style=display:flex><span><span style=color:#555>{</span><span style=color:#c30>&#34;review_id&#34;</span>:<span style=color:#c30>&#34;NjbiESXotcEdsyTc4EM3fg&#34;</span>,<span style=color:#c30>&#34;user_id&#34;</span>:<span style=color:#c30>&#34;PR9LAM19rCM_HQiEm5OP5w&#34;</span>,<span style=color:#c30>&#34;business_id&#34;</span>:<span style=color:#c30>&#34;UAtX7xmIfdd1W2Pebf6NWg&#34;</span>,<span style=color:#c30>&#34;stars&#34;</span>:3.0,<span style=color:#c30>&#34;useful&#34;</span>:0,<span style=color:#c30>&#34;funny&#34;</span>:0,<span style=color:#c30>&#34;cool&#34;</span>:0,<span style=color:#c30>&#34;text&#34;</span>:<span style=color:#c30>&#34;-If you&#39;re into cheap beer (pitcher of bud-light for </span><span style=color:#033>$7</span><span style=color:#c30>) decent wings and a good time, this is the place for you. Its generally very packed after work hours and weekends. Don&#39;t expect cocktails. \n\n-You run into a lot of sketchy characters here sometimes but for the most part if you&#39;re chilling with friends its not that bad. \n\n-Friendly bouncer and bartenders.&#34;</span>,<span style=color:#c30>&#34;date&#34;</span>:<span style=color:#c30>&#34;2016-04-12 20:23:24&#34;</span><span style=color:#555>}</span>
</span></span></code></pre></div><p><div class="alert alert-success" role=alert><p class=alert-heading>Workshop Question</p><div class=alert-body><p class=p-alert-body><ul><li>What does this application do?</li><li>Do you see the yelp dataset being used?</li><li>Why did the output of pip freeze differ each time you ran it?</li><li>Which port is the REVIEW app listening on? Can other python apps use this same port?</li></ul></p></div></div>}</p><h2 id=2-create-a-review-container>2. Create a REVIEW container</h2><p>To create a container image, you need to create a Dockerfile, run docker build to build the image referencing the Docker file and push it up to a remote repository so it can be pulled by other sources.</p><ul><li><a href=https://docs.docker.com/get-started/02_our_app/ target=_blank>Create a Dockerfile</a></li><li>Creating a Dockerfile typically requires you to consider the following:<ul><li>Identify an appropriate container image<ul><li>ubuntu vs. python vs. alpine/slim</li><li>ubuntu - overkill, large image size, wasted resources when running in K8</li><li>this is a python app, so pick an image that is optimized for it</li><li><a href=https://lih-verma.medium.com/alpine-makes-python-docker-builds-way-too-50-slower-and-images-double-2-larger-61d1d43cbc79 target=_blank>avoid alpine for python</a></li></ul></li><li>Order matters<ul><li>you&rsquo;re building layers.</li><li>re-use the layers as much as possible</li><li>have items that change often towards the end</li></ul></li><li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ target=_blank>Other Best practices for writing Dockerfiles</a></li></ul></li></ul><p>Dockerfile for review</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#069;font-weight:700>FROM</span><span style=color:#c30> python:3.10-slim</span><span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>WORKDIR</span><span style=color:#c30> /app</span><span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>COPY</span> requirements.txt /app<span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>RUN</span> pip install -r requirements.txt<span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>COPY</span> ./review.py /app<span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>EXPOSE</span><span style=color:#c30> 5000</span><span style=color:#a00;background-color:#faa>
</span></span></span><span style=display:flex><span><span style=color:#a00;background-color:#faa></span><span style=color:#069;font-weight:700>CMD</span> [ <span style=color:#c30>&#34;python&#34;</span>, <span style=color:#c30>&#34;review.py&#34;</span> ]<span style=color:#a00;background-color:#faa>
</span></span></span></code></pre></div><p>Create a container image (locally)
Run ‘docker build’ to build a local container image referencing the Dockerfile</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#555>(</span>venv<span style=color:#555>)</span>% docker build -f Dockerfile -t localhost:8000/review:0.01 .
</span></span><span style=display:flex><span><span style=color:#555>[</span>+<span style=color:#555>]</span> Building 35.5s <span style=color:#555>(</span>11/11<span style=color:#555>)</span> <span style=color:#033>FINISHED</span>
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>[</span>internal<span style=color:#555>]</span> load build definition from Dockerfile                              0.0s
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>[</span>3/5<span style=color:#555>]</span> COPY requirements.txt /app                                              0.0s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>[</span>4/5<span style=color:#555>]</span> RUN pip install -r requirements.txt                                     4.6s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>[</span>5/5<span style=color:#555>]</span> COPY ./review.py /app                                                   0.0s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; exporting to image                                                            0.2s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>=</span>&gt; exporting layers                                                           0.2s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>=</span>&gt; writing image sha256:61da27081372723363d0425e0ceb34bbad6e483e698c6fe439c5  0.0s
</span></span><span style=display:flex><span> <span style=color:#555>=</span>&gt; <span style=color:#555>=</span>&gt; naming to docker.io/localhost:8000/review:0.1                                   0.0
</span></span></code></pre></div><p>Push the container image into a container repository
Run ‘docker push’ to place a copy of the REVIEW container to a remote location</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker push localhost:8000/review:0.01
</span></span><span style=display:flex><span>The push refers to repository <span style=color:#555>[</span>docker.io/localhost:8000/review<span style=color:#555>]</span>
</span></span><span style=display:flex><span>02c36dfb4867: Pushed
</span></span><span style=display:flex><span>         ...snip...
</span></span><span style=display:flex><span>fd95118eade9: Pushed
</span></span><span style=display:flex><span>0.1: digest: sha256:3651f740abe5635af95d07acd6bcf814e4d025fcc1d9e4af9dee023a9b286f38 size: <span style=color:#f60>2202</span>
</span></span></code></pre></div><p>Verify that the image is in Docker Hub. The same info can be found in Docker Desktop</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s http://localhost:8000/v2/_catalog
</span></span><span style=display:flex><span><span style=color:#555>{</span><span style=color:#c30>&#34;repositories&#34;</span>:<span style=color:#555>[</span><span style=color:#c30>&#34;review&#34;</span><span style=color:#555>]}</span>
</span></span></code></pre></div><h2 id=3-run-review-in-kubernetes>3. Run REVIEW in Kubernetes</h2><p>Create K8 deployment yaml file for the REVIEW app</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment target=_blank>Creating a Deployment</a></p><p>review.deployment.yaml</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#f60>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>imagePullSecrets</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>regcred<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>localhost:8000/review:0.01<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:#309;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/var/appdata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>appdata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>volumes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>appdata<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>hostPath</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>path</span>:<span style=color:#bbb> </span>/var/appdata<span style=color:#bbb>
</span></span></span></code></pre></div><p>Notes regarding review.deployment.yaml:</p><ul><li>labels - K8 uses labels and selectors to tag and identify resources<ul><li>In the next step, we&rsquo;ll create a service and associate it to this deployment using the label</li></ul></li><li>replicas = 1<ul><li>K8 allows you to scale your deployments horizontally</li><li>We&rsquo;ll leverage this later to add load and increase our ingestion rate</li></ul></li><li>regcred provides this deployment with the ability to access your dockerhub credentials which is necessary to pull the container image.</li><li>The volume definition and volumemount make the yelp dataset visible to the container</li></ul><p>Create a K8 service yaml file for the review app.</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/services-networking/service/#defining-a-service target=_blank>Creating a service:</a></p><p>review.service.yaml</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>type</span>:<span style=color:#bbb> </span>NodePort<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>review<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>ports</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#309;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#f60>5000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>targetPort</span>:<span style=color:#bbb> </span><span style=color:#f60>5000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>nodePort</span>:<span style=color:#bbb> </span><span style=color:#f60>30000</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Notes about review.service.yaml:</p><ul><li>the selector associates this service to pods with the label app with the value being review</li><li>the review service exposes the review pods as a network service<ul><li>other pods can now ping &lsquo;review&rsquo; and they will hit a review pod.</li><li>a pod would get a review if it ran <code>curl http://review:5000</code></li></ul></li><li>NodePort service<ul><li>the service is accessible to the K8 host by the nodePort, 30000</li><li>Another machine that has this can get a review if it ran <code>curl http://&lt;k8 host ip>:30000</code></li></ul></li></ul><p>Apply the review deployment and service</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f review.service.yaml -f review.deployment.yaml
</span></span></code></pre></div><p>Verify that the deployment and services are running:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ kubectl get deployments
</span></span><span style=display:flex><span>NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>review                                                  1/1     1            1           19h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ kubectl get services
</span></span><span style=display:flex><span>NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
</span></span><span style=display:flex><span>review                     NodePort    10.43.175.21    &lt;none&gt;        5000:30000/TCP                  154d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ curl localhost:30000
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;message&#34;: &#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>ubuntu@ip-10-0-1-54:/tmp$ curl localhost:30000/get_review
</span></span><span style=display:flex><span>{&#34;review_id&#34;:&#34;Vv9rHtfBrFc-1M1DHRKN9Q&#34;,&#34;user_id&#34;:&#34;EaNqIwKkM7p1bkraKotqrg&#34;,&#34;business_id&#34;:&#34;TA1KUSCu8GkWP9w0rmElxw&#34;,&#34;stars&#34;:3.0,&#34;useful&#34;:1,&#34;funny&#34;:0,&#34;cool&#34;:0,&#34;text&#34;:&#34;This is the first time I&#39;ve actually written a review for Flip, but I&#39;ve probably been here about 10 times.  \n\nThis used to be where I would take out of town guests who wanted a good, casual, and relatively inexpensive meal.  \n\nI hadn&#39;t been for a while, so after a long day in midtown, we decided to head to Flip.  \n\nWe had the fried pickles, onion rings, the gyro burger, their special burger, and split a nutella milkshake.  I have tasted all of the items we ordered previously (with the exception of the special) and have been blown away with how good they were.  My guy had the special which was definitely good, so no complaints there.  The onion rings and the fried pickles were greasier than expected.  Though I&#39;ve thought they were delicious in the past, I probably wouldn&#39;t order either again.  The gyro burger was good, but I could have used a little more sauce.  It almost tasted like all of the ingredients didn&#39;t entirely fit together.  Something was definitely off. It was a friday night and they weren&#39;t insanely busy, so I&#39;m not sure I would attribute it to the staff not being on their A game...\n\nDon&#39;t get me wrong.  Flip is still good.  The wait staff is still amazingly good looking.  They still make delicious milk shakes.  It&#39;s just not as amazing as it once was, which really is a little sad.&#34;,&#34;date&#34;:&#34;2010-10-11 18:18:35&#34;}
</span></span></code></pre></div><div class="alert alert-success" role=alert><p class=alert-heading>Workshop Question</p><div class=alert-body><p class=p-alert-body>What changes are required if you need to make an update to your Dockerfile now?</p></div></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/splunk aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/splunk/observability-workshop aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Splunk Inc. All Rights Reserved</small></div></div></div></footer></div><script src=/observability-workshop/v4.54/js/main.min.2aff983e9d0d8ecff9ed53e14b657216e2d8d2aff059bf4a5651283020995f1b.js integrity="sha256-Kv+YPp0Njs/57VPhS2VyFuLY0q/wWb9KVlEoMCCZXxs=" crossorigin=anonymous></script>
<script src=/observability-workshop/v4.54/js/tabpane-persist.js></script>
<script>const svgCopy='<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg>',svgCheck='<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" fill="rgb(63, 185, 80)" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>',addCopyButtons=e=>{document.querySelectorAll("pre > code").forEach(t=>{const n=document.createElement("button");n.className="clipboard-button",n.type="button",n.innerHTML=svgCopy,n.addEventListener("click",()=>{textToCopy=t.innerText.replace(/^\s*\n/gm,""),console.log(textToCopy),e.writeText(textToCopy).then(()=>{n.blur(),n.innerHTML=svgCheck,setTimeout(()=>n.innerHTML=svgCopy,2e3)},e=>n.innerHTML="Error")});const s=t.parentNode;s.parentNode.insertBefore(n,s)})};if(navigator&&navigator.clipboard)addCopyButtons(navigator.clipboard);else{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",e.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",e.crossOrigin="anonymous",e.onload=()=>addCopyButtons(clipboard),document.body.appendChild(e)}</script></body></html>